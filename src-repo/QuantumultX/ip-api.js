const country0 = "MUC";
const region0 = "韦恩大厦";
const city0 = "高谭市";
const ips0 = "MCU.com";

const map = {"薩":"萨","濟":"济","橋":"桥","魯":"鲁","溫":"温", "區":"区", "奧":"奥", "羅":"罗", "爾":"尔", "縣":"县", "蘭":"兰", "華":"华","壢":"坜","裏":"里", "約":"约", "熱":"热", "內":"内", "盧":"卢","萬":"万","與":"与","專":"专","業":"业","東":"东","絲":"丝","丟":"丢","兩":"两","嚴":"严","喪":"丧","個":"个","豐":"丰","臨":"临","為":"为","麗":"丽","舉":"举","麼":"么","義":"义","烏":"乌","樂":"乐","喬":"乔","習":"习","鄉":"乡","書":"书","買":"买","亂":"乱","爭":"争","於":"于","虧":"亏","雲":"云","亞":"亚","產":"产","畝":"亩","親":"亲","億":"亿","價":"价","儀":"仪","億":"亿","優":"优","會":"会","傴":"伛","偉":"伟","傳":"传","傷":"伤","倫":"伦","偽":"伪","體":"体","佇":"伫","佈":"布","佔":"占","協":"协","單":"单","衛":"卫","卻":"却","廠":"厂","歷":"历","參":"参","雙":"双","發":"发","變":"变","叢":"丛","台":"台","葉":"叶","後":"后","員":"员","問":"问","國":"国","圖":"图","圍":"围","園":"园","團":"团","壞":"坏","壩":"坝","壯":"壮","聲":"声","壺":"壶","處":"处","備":"备","復":"复","夠":"够","夢":"梦","奪":"夺","奮":"奋","婦":"妇","協":"协","絕":"绝","愛":"爱","觀":"观","訴":"诉","尋":"寻","導":"导","對":"对","屬":"属","岡":"冈","島":"岛","崗":"岗","峽":"峡","嶺":"岭","嶽":"岳","巖":"岩","幣":"币","廣":"广","廳":"厅","應":"应","廟":"庙","庫":"库","廢":"废","開":"开","張":"张","彈":"弹","強":"强","歸":"归","當":"当","錄":"录","彙":"汇","彈":"弹","懷":"怀","總":"总","戰":"战","戶":"户","撥":"拨","擴":"扩","擇":"择","擊":"击","擠":"挤","擁":"拥","擬":"拟","擾":"扰","敵":"敌","數":"数","斷":"断","時":"时","晉":"晋","曆":"历","會":"会","朧":"胧","東":"东","極":"极","標":"标","榮":"荣","構":"构","樣":"样","樸":"朴","樹":"树","機":"机","橫":"横","檔":"档","檢":"检","歡":"欢","歲":"岁","歷":"历","歐":"欧","殘":"残","殼":"壳","毆":"殴","氣":"气","漢":"汉","沒":"没","災":"灾","為":"为","烏":"乌","無":"无","煉":"炼","煙":"烟","熱":"热","燦":"灿","營":"营","爐":"炉","爛":"烂","爭":"争","爺":"爷","牆":"墙","牽":"牵","犧":"牺","狀":"状","獨":"独","現":"现","環":"环","產":"产","畫":"画","當":"当","瘋":"疯","發":"发","盜":"盗","盞":"盏","盡":"尽","監":"监","盤":"盘","矯":"矫","礎":"础","禍":"祸","禪":"禅","禮":"礼","稅":"税","穎":"颖","穩":"稳","窩":"窝","簡":"简","糧":"粮","糾":"纠","紀":"纪","純":"纯","紐":"纽","級":"级","納":"纳","紙":"纸","紛":"纷","終":"终","組":"组","經":"经","結":"结","給":"给","絕":"绝","統":"统","絲":"丝","綠":"绿","維":"维","緊":"紧","線":"线","編":"编","練":"练","縮":"缩","績":"绩","繼":"继","繩":"绳","繪":"绘","繫":"系","纖":"纤","總":"总","聖":"圣","聞":"闻","聯":"联","聰":"聪","職":"职","腦":"脑","腳":"脚","臉":"脸","舊":"旧","與":"与","興":"兴","舉":"举","艦":"舰","藝":"艺","萬":"万","蔣":"蒋","葉":"叶","藍":"蓝","蘇":"苏","號":"号","處":"处","虛":"虚","衛":"卫","觀":"观","視":"视","訓":"训","評":"评","詞":"词","詩":"诗","誌":"志","認":"认","誕":"诞","語":"语","誠":"诚","調":"调","談":"谈","請":"请","論":"论","諸":"诸","諾":"诺","讀":"读","變":"变","貓":"猫","貝":"贝","負":"负","財":"财","貨":"货","販":"贩","責":"责","貴":"贵","買":"买","貿":"贸","賀":"贺","資":"资","賓":"宾","賞":"赏","賣":"卖","賠":"赔","賬":"账","質":"质","賴":"赖","贊":"赞","贈":"赠","贏":"赢","趙":"赵","趨":"趋","跡":"迹","車":"车","軋":"轧","軍":"军","軌":"轨","軒":"轩","軟":"软","較":"较","載":"载","輸":"输","輕":"轻","輩":"辈","輪":"轮","輯":"辑","輸":"输","輻":"辐","轉":"转","農":"农","邊":"边","達":"达","遞":"递","遠":"远","適":"适","選":"选","遲":"迟","遼":"辽","醫":"医","釋":"释","鑄":"铸","鎮":"镇","鐘":"钟","鐵":"铁","鑽":"钻","長":"长","門":"门","閣":"阁","閱":"阅","隊":"队","陽":"阳","陰":"阴","際":"际","險":"险","雜":"杂","雙":"双","雲":"云","電":"电","預":"预","頗":"颇","領":"领","頭":"头","頻":"频","題":"题","額":"额","風":"风","飛":"飞","餐":"餐","馬":"马","駕":"驾","駛":"驶","騎":"骑","驗":"验","高":"高","麼":"么","麼":"么","麼":"么","鳳":"凤","鷹":"鹰","鳥":"鸟","鹽":"盐","麗":"丽","黃":"黄","黑":"黑","點":"点","齒":"齿","龍":"龙","灣":"湾","臺":"台","紐":"纽","廣":"广","滙":"汇","滙豐":"汇丰"};

const flags = new Map([["AC","🇦🇨"],["AD","🇦🇩"],["AE","🇦🇪"],["AF","🇦🇫"],["AG","🇦🇬"],["AI","🇦🇮"],["AL","🇦🇱"],["AM","🇦🇲"],["AO","🇦🇴"],["AQ","🇦🇶"],["AR","🇦🇷"],["AS","🇦🇸"],["AT","🇦🇹"],["AU","🇦🇺"],["AW","🇦🇼"],["AX","🇦🇽"],["AZ","🇦🇿"],["BA","🇧🇦"],["BB","🇧🇧"],["BD","🇧🇩"],["BE","🇧🇪"],["BF","🇧🇫"],["BG","🇧🇬"],["BH","🇧🇭"],["BI","🇧🇮"],["BJ","🇧🇯"],["BM","🇧🇲"],["BN","🇧🇳"],["BO","🇧🇴"],["BR","🇧🇷"],["BS","🇧🇸"],["BT","🇧🇹"],["BV","🇧🇻"],["BW","🇧🇼"],["BY","🇧🇾"],["BZ","🇧🇿"],["CA","🇨🇦"],["CD","🇨🇩"],["CF","🇨🇫"],["CG","🇨🇬"],["CH","🇨🇭"],["CI","🇨🇮"],["CK","🇨🇰"],["CL","🇨🇱"],["CM","🇨🇲"],["CN","🇨🇳"],["CO","🇨🇴"],["CP","🇨🇵"],["CR","🇨🇷"],["CU","🇨🇺"],["CV","🇨🇻"],["CW","🇨🇼"],["CX","🇨🇽"],["CY","🇨🇾"],["CZ","🇨🇿"],["DE","🇩🇪"],["DG","🇩🇬"],["DJ","🇩🇯"],["DK","🇩🇰"],["DM","🇩🇲"],["DO","🇩🇴"],["DZ","🇩🇿"],["EA","🇪🇦"],["EC","🇪🇨"],["EE","🇪🇪"],["EG","🇪🇬"],["EH","🇪🇭"],["ER","🇪🇷"],["ES","🇪🇸"],["ET","🇪🇹"],["EU","🇪🇺"],["FI","🇫🇮"],["FJ","🇫🇯"],["FK","🇫🇰"],["FM","🇫🇲"],["FO","🇫🇴"],["FR","🇫🇷"],["GA","🇬🇦"],["GB","🇬🇧"],["GD","🇬🇩"],["GE","🇬🇪"],["GF","🇬🇫"],["GH","🇬🇭"],["GI","🇬🇮"],["GL","🇬🇱"],["GM","🇬🇲"],["GN","🇬🇳"],["GP","🇬🇵"],["GR","🇬🇷"],["GT","🇬🇹"],["GU","🇬🇺"],["GW","🇬🇼"],["GY","🇬🇾"],["HK","🇭🇰"],["HN","🇭🇳"],["HR","🇭🇷"],["HT","🇭🇹"],["HU","🇭🇺"],["ID","🇮🇩"],["IE","🇮🇪"],["IL","🇮🇱"],["IM","🇮🇲"],["IN","🇮🇳"],["IQ","🇮🇶"],["IR","🇮🇷"],["IS","🇮🇸"],["IT","🇮🇹"],["JM","🇯🇲"],["JO","🇯🇴"],["JP","🇯🇵"],["KE","🇰🇪"],["KG","🇰🇬"],["KH","🇰🇭"],["KI","🇰🇮"],["KM","🇰🇲"],["KN","🇰🇳"],["KP","🇰🇵"],["KR","🇰🇷"],["KW","🇰🇼"],["KY","🇰🇾"],["KZ","🇰🇿"],["LA","🇱🇦"],["LB","🇱🇧"],["LC","🇱🇨"],["LI","🇱🇮"],["LK","🇱🇰"],["LR","🇱🇷"],["LS","🇱🇸"],["LT","🇱🇹"],["LU","🇱🇺"],["LV","🇱🇻"],["LY","🇱🇾"],["MA","🇲🇦"],["MC","🇲🇨"],["MD","🇲🇩"],["MG","🇲🇬"],["MH","🇲🇭"],["MK","🇲🇰"],["ML","🇲🇱"],["MM","🇲🇲"],["MN","🇲🇳"],["MO","🇲🇴"],["MP","🇲🇵"],["MQ","🇲🇶"],["MR","🇲🇷"],["MS","🇲🇸"],["MT","🇲🇹"],["MU","🇲🇺"],["MV","🇲🇻"],["MW","🇲🇼"],["MX","🇲🇽"],["MY","🇲🇾"],["MZ","🇲🇿"],["NA","🇳🇦"],["NC","🇳🇨"],["NE","🇳🇪"],["NF","🇳🇫"],["NG","🇳🇬"],["NI","🇳🇮"],["NL","🇳🇱"],["NO","🇳🇴"],["NP","🇳🇵"],["NR","🇳🇷"],["NZ","🇳🇿"],["OM","🇴🇲"],["PA","🇵🇦"],["PE","🇵🇪"],["PF","🇵🇫"],["PG","🇵🇬"],["PH","🇵🇭"],["PK","🇵🇰"],["PL","🇵🇱"],["PM","🇵🇲"],["PR","🇵🇷"],["PS","🇵🇸"],["PT","🇵🇹"],["PW","🇵🇼"],["PY","🇵🇾"],["QA","🇶🇦"],["RE","🇷🇪"],["RO","🇷🇴"],["RS","🇷🇸"],["RU","🇷🇺"],["RW","🇷🇼"],["SA","🇸🇦"],["SB","🇸🇧"],["SC","🇸🇨"],["SD","🇸🇩"],["SE","🇸🇪"],["SG","🇸🇬"],["SI","🇸🇮"],["SK","🇸🇰"],["SL","🇸🇱"],["SM","🇸🇲"],["SN","🇸🇳"],["SO","🇸🇴"],["SR","🇸🇷"],["ST","🇸🇹"],["SV","🇸🇻"],["SY","🇸🇾"],["SZ","🇸🇿"],["TC","🇹🇨"],["TD","🇹🇩"],["TG","🇹🇬"],["TH","🇹🇭"],["TJ","🇹🇯"],["TL","🇹🇱"],["TM","🇹🇲"],["TN","🇹🇳"],["TO","🇹🇴"],["TR","🇹🇷"],["TT","🇹🇹"],["TV","🇹🇻"],["TW","🇨🇳"],["TZ","🇹🇿"],["UA","🇺🇦"],["UG","🇺🇬"],["UK","🇬🇧"],["UM","🇺🇲"],["US","🇺🇸"],["UY","🇺🇾"],["UZ","🇺🇿"],["VA","🇻🇦"],["VC","🇻🇨"],["VE","🇻🇪"],["VG","🇻🇬"],["VI","🇻🇮"],["VN","🇻🇳"],["VU","🇻🇺"],["WS","🇼🇸"],["YE","🇾🇪"],["YT","🇾🇹"],["ZA","🇿🇦"],["ZM","🇿🇲"],["ZW","🇿🇼"]]);

function country_ValidCheck(para) { const countryMap = {"中華民國":"台湾","中华民国":"台湾","俄罗斯联邦":"俄罗斯","德意志联邦共和国":"德国","Libya":"利比亚"}; return countryMap[para ? para.trim() : ""] || para || country0; }

function Area_check(para) { const areaMap = {"Dubai":"迪拜","Fujairah":"富查伊拉","Imārat Umm al Qaywayn":"乌姆盖万","Fès-Meknès":"非斯-梅克内斯大区","Tirana":"地拉那","Vienna":"维也纳","new south wales":"新南威尔士州","New South Wales":"新南威尔士州","Victoria":"维多利亚州","Buenos Aires F.D.":"布宜诺斯艾利斯","Baku City":"巴库市","Lankaran Rayon":"连科兰区","布鲁塞尔首都大区":"布鲁塞尔","Sofia-Capital":"索非亚市","Sao Paulo":"圣保罗州","Ontario":"安大略省","Quebec":"魁北克省","Zurich":"苏黎世州","圣地亚哥首都大区":"圣地亚哥大区","Bogota D.C.":"波哥大首都区","Provincia de San José":"圣何塞省","臺北市":"台北市","臺灣省 or 台湾省":"台北市","中华民国":"台湾","Taiwan":"台湾","Changhua":"彰化市","Taichung City":"台中市","Taoyuan":"桃园市","Yunlin":"云林县","Havana":"哈瓦那","Prague":"布拉格市","石勒苏益格-荷尔斯泰因":"石荷州","Hesse":"黑森州","Capital Region":"哥本哈根大区","Catalonia":"加泰罗尼亚自治区","Madrid":"马德里自治区","法兰西岛":"法兰西岛大区","奧弗涅-羅訥-阿爾卑斯大區":"奥罗阿大区","普罗旺斯-阿尔卑斯-蔚蓝海岸大区":"普阿蓝大区","Île-de-France":"法兰西岛大区","City of Zagreb":"萨格勒布市","Wales":"威尔士","Sermersooq":"瑟默索克","Attica":"阿提卡","Greater Accra Region":"大阿克拉地区","Kowloon":"九龙城区","Wong Tai Sin":"黄大仙区","Sai Kung District":"西贡区","Sham Shui Po":"深水埗区","Tsuen Wan District":"荃湾区","Budapest":"布达佩斯","Jakarta":"雅加达","Tel Aviv":" 特拉维夫区","National Capital Territory of Delhi":"德里","Southern Peninsula":"雷克雅内斯半岛","Lombardy":"伦巴第大区","Lazio":"拉齐奥大区","Tokyo":"东京都","Osaka":"大阪府","Ōsaka":"大阪府","Mto Panga":"姆托潘加","Daegu":"大邱广域市","Gangwon-do":"江原道","Jeollabuk-do":"全罗北道","Incheon":"仁川广域市","North Chungcheong":"忠清北道","Phnom Penh":"金边市","Almaty":"阿拉木图州","Almaty Oblysy":"阿拉木图州","Aqmola":"阿克莫拉州","Astana":"阿斯塔纳","Zhambyl Oblysy":"江布尔州","Diekirch":"迪基希区","Luxembourg":"卢森堡市","Rīga":"里加","Sha‘bīyat Banghāzī":"班加西省","Tripoli":"的黎波里","Chișinău Municipality":"基希讷乌","Grand Port District":"大港区","Kuala Lumpur":"吉隆坡","Ulaanbaatar":"乌兰巴托市","Lagos":"拉各斯","North Holland":"北荷兰省","Oslo County":"奥斯陆市","Viken":"维肯郡","Bagmati Province":"巴格马蒂省","Muscat":"马斯喀特省","Metro Manila":"大马尼拉都会区","Northern Mindanao":"北棉兰老大区","Mazovia":"马佐夫舍省","Belgrade":"贝尔格莱德","Moscow":"莫斯科州","St.-Petersburg":"西北联邦区","Tatarstan Republic":"鞑靼斯坦共和国","București":"布加勒斯特","Mecca Region":"麦加省","Honiara":"霍尼亚拉","Stockholm":"斯德哥尔摩","Stockholm County":"斯德哥尔摩","Central Singapore":"中区","North West":"西北区","North East":"东北区","South West":"西南区","South East":"东南区","Banaadir":"班纳迪尔地区","Zanzibar Urban/West":"桑给巴尔市","Ang Thong":"红统府","Kyiv City":"基辅州","加州":"加利福尼亚州","麻薩諸塞州":"马萨诸塞州","Arizona":"亚利桑那州","Tashkent":"塔什干","Miranda":"米兰达州","Hanoi":"河内市","Hòa Bình Province":"和平省","Hải Dương Province":"海阳省","Ho Chi Minh City (HCMC)":"胡志明市","Hai Phong":"海防市","Da Nang City":"岘港市"}; return areaMap[para ? para.trim() : ""] || para || region0; }

function City_ValidCheck(para) { const cityMap = {"Masdar City":"马斯达尔城","Muhadhdhib":"穆哈德布地区","Fes":"非斯","Yerevan":"埃里温","Cruz del Eje":"克鲁斯德尔埃赫","Vienna":"维也纳","Melton":"梅尔顿","Lankaran":"连科兰","Ottawa":"渥太华","Bhātāra":"巴塔拉","Rāipur":"赖布尔","José Bonifácio":"若泽博尼法西奥市","Osasco":"奥萨斯库","São Paulo":"圣保罗","Sao Paulo":"圣保罗","Vinhedo":"维涅杜","Lampa":"兰帕","České Budějovice":"捷克布杰约维采","Cota":"科塔","San José":"圣何塞","Frankfurt":"法兰克福","Frankfurt am Main":"法兰克福","Frankfurt Am Main":"法兰克福","Madrid":"马德里","倫敦金融城":"伦敦","Harlesden":"哈利斯登","Hounslow":"伦敦","Slough":"斯劳","Porto Rafti":"波尔图拉夫提镇","Guatemala City":"危地马拉城","Wenquan":"福州市","Cheung Sha Wan":"长沙湾","Sheung Wan":"上环","The Latitude":"誉港湾","Tseung Kwan O":"将军澳","Tsuen Wan":"荃湾","Tsing Yi":"青衣","Changhua":"彰化县","Szigetszentmiklós":"锡盖特圣米克洛什","Gubengairlangga":"泗水市","Rosh Ha‘Ayin":"罗什艾因","BILASPUR":"比拉斯布尔","Badaganhatti":"巴达甘哈提","Mumbai":"孟买","Santa Cruz":"圣克鲁斯","Tiruvānmiyūr":"钦奈市","Milan":"米兰","Milano":"米兰","Gallarate":"加拉拉泰","Ponte San Pietro":"蓬泰圣彼得罗","Siziano":"西齐亚诺","Lido di Ostia":"奥斯蒂亚海滨","東京都":"涩谷区","Chiyoda":"千代田区","Chiyoda City":"千代田区","Ebara":"品川区","Shibuya":"涩谷区","Negishi":"根岸","Osaka":"大阪市","Ōkubo-naka":"熊取町","Mto Panga":"姆托潘加","Dongjak-gu":"铜雀区","Gasan-dong":"加山洞","Gangnam-gu":"江南区","Gangseo-gu":"江西区","Gwanak-gu":"冠岳区","Jowon-dong":"枣园洞","Yongsan-dong":"龙山区","Bucheon-si":"富川市","Gimpo-si":"金浦市","Seongnam-si":"城南市","Yuseong-gu":"儒城区","Gunsan":"群山市","Muju-gun":"茂朱郡","Cheongju-si":"清州市","Yeongdong-gun":"永同郡","Aqtöbe":"阿克托别","Talghar":"塔尔加尔","Schieren":"希伦","Contern":"孔特恩","Vilnius":"维尔纽斯","Riga":"里加","Querétaro":"克雷塔罗","Sîngera":"辛热拉","Shara-Höbiin-Dugang":"乌兰巴托市","拉哥斯":"拉各斯","Seeb":"锡卜","Pasig":"帕赛市","Taguig":"达义市","Impaya-ao":"布基农","Viana do Castelo":"维亚纳堡","Jessheim":"杰斯海姆","Lorenskog":"勒伦斯科格","Montijo":"蒙蒂茹","Rucka":"新贝尔格莱德","St Petersburg":"圣彼得堡","Voluntari":"沃伦塔里","Dumbrăviţa":"敦布勒维察","Sha`ib al Malqah":"埃尔奥拉","Steninge":"斯特宁厄","Karatay":"科尼亚市","Esenyurt":"埃森尤特区","Kocasinan":"科卡西南","Mtoni":"桑给巴尔市","Taoyuan":"桃园区","Yuanlin":"员林镇","Ang Thong":"红统府","Pomichna":"波莫什纳亚","Kyiv":"基辅","Yahotyn":"亚霍廷区","Lutsk":"卢茨克区","San Jose":"圣荷西","Ashburn":"阿什本","Boydton":"博伊顿","Reston":"雷斯顿","Aldine":"奥尔代恩","Flower Mound":"弗洛尔蒙特","Dublin":"都柏林","Reynoldsburg":"雷诺兹堡","Cheektowaga":"奇克托瓦加镇","Piscataway":"皮斯卡特维镇","Secaucus":"锡考克斯镇","Elk Grove Village":"埃尔克格罗夫村","Miranda":"加拉加斯市","Quận Phú Nhuận":"富润郡","Trâu Quỳ":"嘉林县","Hải Dương":"海阳市","Chitungwiza":"奇通圭扎"}; return cityMap[para ? para.trim() : ""] || para || city0; }

function ISP_ValidCheck(para) { return para || ips0; }

function t2s(str) {
  if (!str) return "";
  let res = "";
  for (let i = 0; i < str.length; i++) {
    const c = str[i];
    res += map[c] || c;
  }
  return res;
}

if ($response.statusCode != 200) {
  $done(null);
}

let body = $response.body;
let obj = JSON.parse(body);

const rawCountry = (obj['country'] || "").trim();
const rawRegionName = (obj['regionName'] || "").trim();
const rawCity = (obj['city'] || "").trim();
const rawIsp = (obj['isp'] || "").trim();

const country = country_ValidCheck(rawCountry);
const region = Area_check(rawRegionName);
const city = City_ValidCheck(rawCity);
const isp = ISP_ValidCheck(rawIsp);

const ip = obj['query'];
const lat = obj['lat'];
const lon = obj['lon'];
const timezone = obj['timezone'];

let displayCity = (city !== country && city !== region) ? city : '';

let title = (flags.get(obj['countryCode']) || "") + ' ' + country + ' ' + region;
let subtitle = (displayCity ? displayCity + ' · ' : '') + ip + ' · ' + isp;

let description =
  '--------------------------------------\n' +
  '🌍 国家 / Country:\n' + obj['countryCode'] + ' ' + country + '\n\n' +
  '📍 地区 / Region:\n' + obj['region'] + ' ' + region + '\n\n' +
  '🏙️ 城市 / City:\n' + obj['city'] + '\n\n' +
  '🌐 IP地址 / IP:\n' + ip + '\n\n' +
  '🏢 运营商 / ISP:\n' + isp + '\n\n' +
  '📌 经纬度 / Lat & Lon:\n' + lat + ' / ' + lon + '\n\n' +
  '🕒 时区 / Timezone:\n' + timezone + '\n' +
  '--------------------------------------';

$done({
  title: t2s(title),
  subtitle: t2s(subtitle),
  ip: ip,
  description: t2s(description)
});
