// IPPure + IP-API ç»¼åˆç›‘æµ‹ç»„ä»¶
const geoUrl = "http://ip-api.com/json/?lang=zh-CN";
const riskUrl = "https://my.ippure.com/v1/info";

// --- é¢„åŠ è½½å­—å…¸ ---
const S_CHARS = 'é”•çš‘è”¼ç¢çˆ±å—³å«’ç‘·æš§éœ­è°™é“µé¹Œè‚®è¢„å¥¥åªªéªœé³Œåç½¢é’¯æ‘†è´¥å‘—é¢åŠç»Šé’£å¸®ç»‘é•‘è°¤å‰¥é¥±å®æŠ¥é²é¸¨é¾…è¾ˆè´é’¡ç‹ˆå¤‡æƒ«é¹è´²é”›ç»·ç¬”æ¯•æ¯™å¸é—­èœå“”æ»—é“‹ç­šè·¸è¾¹ç¼–è´¬å˜è¾©è¾«è‹„ç¼ç¬¾æ ‡éª é£‘é£™é•–é•³é³”é³–åˆ«ç˜ªæ¿’æ»¨å®¾æ‘ˆå‚§ç¼¤æ§Ÿæ®¡è†‘é•”é«Œé¬“é¥¼ç¦€æ‹¨é’µé“‚é©³é¥½é’¹é¹è¡¥é’¸è´¢å‚èš•æ®‹æƒ­æƒ¨ç¿éª–é»ªè‹èˆ±ä»“æ²§å•ä¾§å†Œæµ‹æ»å±‚è¯§é”¸ä¾ªé’—æ€æºè‰é¦‹è°—ç¼ é“²äº§é˜é¢¤å†è°„è°¶è’‡å¿å©µéª£è§‡ç¦…é•¡åœºå°é•¿å¿è‚ å‚ç•…ä¼¥è‹Œæ€…é˜Šé²³é’è½¦å½»ç —å°˜é™ˆè¡¬ä¼§è°Œæ¦‡ç¢œé¾€æ’‘ç§°æƒ©è¯šéª‹æ¨æŸ½é“–é“›ç—´è¿Ÿé©°è€»é½¿ç‚½é¥¬é¸±å†²å†²è™«å® é“³ç•´è¸Œç­¹ç»¸ä¿¦å¸±é› æ©±å¨é”„é›ç¡€å‚¨è§¦å¤„åˆç»Œè¹°ä¼ é’ç–®é—¯åˆ›æ€†é”¤ç¼çº¯é¹‘ç»°è¾é¾Šè¾è¯èµé¹šèªè‘±å›±ä»ä¸›è‹éª¢æå‡‘è¾è¹¿çªœæ’ºé”™é”‰é¹¾è¾¾å“’é‘å¸¦è´·éª€ç»æ‹…å•éƒ¸æ¸èƒ†æƒ®è¯å¼¹æ®šèµ•ç˜…ç®ªå½“æŒ¡å…šè¡æ¡£è° ç €è£†æ£å²›ç¥·å¯¼ç›—ç„˜ç¯é‚“é•«æ•Œæ¶¤é€’ç¼”ç±´è¯‹è°›ç»¨è§Œé•é¢ ç‚¹å«ç”µå·…é’¿ç™«é’“è°ƒé“«é²·è°å é²½é’‰é¡¶é”­è®¢é“¤ä¸¢é“¥ä¸œåŠ¨æ ‹å†»å²½é¸«çª¦çŠŠç‹¬è¯»èµŒé•€æ¸æ¤Ÿç‰ç¬ƒé»©é”»æ–­ç¼ç°–å…‘é˜Ÿå¯¹æ€¼é•¦å¨é¡¿é’ç‚–è¶¸å¤ºå •é“é¹…é¢è®¹æ¶é¥¿è°”å©é˜è½­é”‡é”·é¹—é¢šé¢›é³„è¯¶å„¿å°”é¥µè´°è¿©é“’é¸¸é²•å‘ç½šé˜€ççŸ¾é’’çƒ¦è´©é¥­è®¿çººé’«é²‚é£è¯½åºŸè´¹ç»¯é•„é²±çº·åŸå¥‹æ„¤ç²ªå¾ä¸°æ«é”‹é£ç–¯å†¯ç¼è®½å‡¤æ²£è‚¤è¾æŠšè¾…èµ‹å¤è´Ÿè®£å¦‡ç¼šå‡«é©¸ç»‚ç»‹èµ™éº¸é²‹é³†é’†è¯¥é’™ç›–èµ…æ†èµ¶ç§†èµ£å°´æ“€ç»€å†ˆåˆšé’¢çº²å²—æˆ†é•ç¾è¯°ç¼Ÿé”†æé¸½é˜é“¬ä¸ªçº¥é•‰é¢ç»™äº˜èµ“ç» é² é¾šå®«å·©è´¡é’©æ²Ÿè‹Ÿæ„è´­å¤Ÿè¯Ÿç¼‘è§è›Šé¡¾è¯‚æ¯‚é’´é”¢é¸ªé¹„é¹˜å‰æŒ‚é¸¹æ´å…³è§‚é¦†æƒ¯è´¯è¯–æ¼é¹³é³å¹¿çŠ·è§„å½’é¾Ÿé—ºè½¨è¯¡è´µåˆ½åŒ¦åˆ¿å¦«æ¡§é²‘é³œè¾Šæ»šè¡®ç»²é²§é”…å›½è¿‡åŸšå‘™å¸¼æ¤èˆé“ªéª‡éŸ©æ±‰é˜šç»—é¢‰å·çé¢¢é˜‚é¹¤è´ºè¯ƒé˜–è›æ¨ªè½°é¸¿çº¢é»‰è®§è­é—³é²å£¶æŠ¤æ²ªæˆ·æµ’é¹•å“—åç”»åˆ’è¯éª…æ¡¦é“§æ€€åæ¬¢ç¯è¿˜ç¼“æ¢å”¤ç—ªç„•æ¶£å¥‚ç¼³é”¾é²©é»„è°é³‡æŒ¥è¾‰æ¯è´¿ç§½ä¼šçƒ©æ±‡è®³è¯²ç»˜è¯™èŸå“•æµç¼‹ç²æ™–è¤æµ‘è¯¨é¦„é˜è·è´§ç¥¸é’¬é•¬å‡»æœºç§¯é¥¥è¿¹è®¥é¸¡ç»©ç¼‰æè¾‘çº§æŒ¤å‡ è“Ÿå‰‚æµè®¡è®°é™…ç»§çºªè®¦è¯˜è å½å“œéª¥ç‘è§Šé½‘çŸ¶ç¾è™¿è·»éœé²šé²«å¤¹èšé¢Šè´¾é’¾ä»·é©¾éƒæµƒé“—é•“è›²æ­¼ç›‘åšç¬ºé—´è‰°ç¼„èŒ§æ£€ç¢±ç¡·æ‹£æ¡ç®€ä¿­å‡èæ§›é‰´è·µè´±è§é”®èˆ°å‰‘é¥¯æ¸æº…æ¶§è°ç¼£æˆ‹æˆ¬ç‘é¹£ç¬•é²£é¯å°†æµ†è’‹æ¡¨å¥–è®²é…±ç»›ç¼°èƒ¶æµ‡éª„å¨‡æ…é“°çŸ«ä¾¥è„šé¥ºç¼´ç»è½¿è¾ƒæŒ¢å³¤é¹ªé²›é˜¶èŠ‚æ´ç»“è¯«å±Šç––é¢Œé²’ç´§é”¦ä»…è°¨è¿›æ™‹çƒ¬å°½åŠ²è†èŒåºè©é¦‘ç¼™èµ†è§é²¸æƒŠç»é¢ˆé™é•œå¾„ç—‰ç«å‡€åˆ­æ³¾è¿³å¼ªèƒ«é“çº å©æ—§é˜„é¸ é¹«é©¹ä¸¾æ®é”¯æƒ§å‰§è®µå±¦æ¦‰é£“é’œé””çª­é¾ƒé¹ƒç»¢é”©é•Œéš½è§‰å†³ç»è°²çé’§å†›éªçš²å¼€å‡¯å‰€å²å¿¾æºé“ é”´é¾›é—¶é’ªé“é¢—å£³è¯¾éª’ç¼‚è½²é’¶é”é¢”å¦æ³é¾ˆé“¿æŠ åº“è£¤å–¾å—ä¾©éƒå“™è„å®½ç‹¯é«‹çŸ¿æ—·å†µè¯“è¯³é‚åœ¹çº©è´¶äºå²¿çª¥é¦ˆæºƒåŒ®è’‰æ„¦è©ç¯‘é˜ƒé”Ÿé²²æ‰©é˜”è›´èœ¡è…Šè±æ¥èµ–å´ƒå¾•æ¶æ¿‘èµ‰çé“¼ç™ç±è“æ æ‹¦ç¯®é˜‘å…°æ¾œè°°æ½è§ˆæ‡’ç¼†çƒ‚æ»¥å²šæ¦„æ–“é•§è¤´ç…é˜†é”’æåŠ³æ¶å” å´‚é“‘é“¹ç—¨ä¹é³“é•­å’ç±»æ³ªè¯”ç¼§ç¯±ç‹¸ç¦»é²¤ç¤¼ä¸½å‰åŠ±ç ¾å†æ²¥éš¶ä¿ªéƒ¦åœè‹ˆè…è“ å‘–é€¦éªŠç¼¡æ¥æ è½¹ç ºé”‚é¹‚ç– ç²è·é›³é²¡é³¢ä¿©è”è²è¿é•°æ€œæ¶Ÿå¸˜æ•›è„¸é“¾æ‹ç‚¼ç»ƒè”¹å¥æ½‹çæ®“è£¢è££é²¢ç²®å‡‰ä¸¤è¾†è°…é­‰ç–—è¾½é•£ç¼­é’Œé¹©çŒä¸´é‚»é³å‡›èµè”ºå»ªæª©è¾šèºé¾„é“ƒçµå²­é¢†ç»«æ£‚è›é²®é¦åˆ˜æµéªç»ºé•é¹¨é¾™è‹å’™ç¬¼å„æ‹¢é™‡èŒæ³·ç‘æ Šèƒ§ç »æ¥¼å¨„æ‚ç¯“å»è’Œå–½åµé•‚ç˜˜è€§è¼é«…èŠ¦å¢é¢…åºç‚‰æ³å¤è™é²èµ‚ç¦„å½•é™†å†æ’¸å™œé—¾æ³¸æ¸Œæ Œæ©¹è½³è¾‚è¾˜æ°‡èƒªé¸¬é¹­èˆ»é²ˆå³¦æŒ›å­ªæ»¦ä¹±è„”å¨ˆæ ¾é¸¾éŠ®æŠ¡è½®ä¼¦ä»‘æ²¦çº¶è®ºå›µèç½—é€»é”£ç®©éª¡éª†ç»œè¦çŒ¡æ³ºæ¤¤è„¶é•™é©´å•é“ä¾£å±¡ç¼•è™‘æ»¤ç»¿æ¦ˆè¤›é”Šå‘’å¦ˆç›ç èš‚é©¬éª‚å—å”›å¬·æ©ä¹°éº¦å–è¿ˆè„‰åŠ¢ç’é¦’è›®æ»¡è°©ç¼¦é•˜é¢¡é³—çŒ«é”šé“†è´¸éº½æ²¡é•é—¨é—·ä»¬æ‰ªç„–æ‡‘é’”é”°æ¢¦çœ¯è°œå¼¥è§…å¹‚èŠˆè°§çŒ•ç¥¢ç»µç¼…æ¸‘è…¼é»¾åº™ç¼ˆç¼ªç­æ‚¯é—½é—µç¼—é¸£é“­è°¬è°Ÿè“¦é¦æ®é•†è°‹äº©é’¼å‘é’ çº³éš¾æŒ è„‘æ¼é—¹é“™è®·é¦å†…æ‹Ÿè…»é“Œé²µæ’µè¾‡é²¶é…¿é¸ŸèŒ‘è¢…è‚å•®é•Šé•é™§è˜–å—«é¢Ÿè¹‘æŸ ç‹å®æ‹§æ³è‹å’›èé’®çº½è„“æµ“å†œä¾¬å“é©½é’•è¯ºå‚©ç–Ÿæ¬§é¸¥æ®´å‘•æ²¤è®´æ€„ç“¯ç›˜è¹’åºæŠ›ç–±èµ”è¾”å–·é¹çº°ç½´é“éª—è°éªˆé£˜ç¼¥é¢‘è´«å«”è‹¹å‡­è¯„æ³¼é¢‡é’‹æ‰‘é“ºæœ´è°±é•¤é•¨æ –è„é½éª‘å²‚å¯æ°”å¼ƒè®«è•²éªç»®æ¡¤ç¢›é¢€é¢ƒé³ç‰µé’é“…è¿ç­¾è°¦é’±é’³æ½œæµ…è°´å ‘ä½¥è¨æ‚­éªç¼±æ¤ é’¤æªå‘›å¢™è”·å¼ºæŠ¢å«±æ¨¯æˆ—ç‚é”–é”µé•ªç¾Ÿè·„é”¹æ¡¥ä¹”ä¾¨ç¿˜çªè¯®è°¯èç¼²ç¡—è··çªƒæƒ¬é”²ç®§é’¦äº²å¯é”“è½»æ°¢å€¾é¡·è¯·åº†æ¿é²­ç¼ç©·èŒ•è›±å·¯èµ‡è™®é³…è¶‹åŒºèº¯é©±é¾‹è¯å²–é˜’è§‘é¸²é¢§æƒåŠè¯ ç»»è¾é“¨å´é¹Šç¡®é˜•é˜™æ‚«è®©é¥¶æ‰°ç»•è›å¨†æ¡¡çƒ­éŸ§è®¤çº«é¥ªè½«è£ç»’åµ˜è¾ç¼›é“·é¢¦è½¯é”èš¬é—°æ¶¦æ´’è¨é£’é³ƒèµ›ä¼æ¯µç³ä¸§éªšæ‰«ç¼«æ¶©å•¬é“¯ç©‘æ€åˆ¹çº±é“©é²¨ç­›æ™’é…¾åˆ é—ªé™•èµ¡ç¼®è®ªå§—éªŸé’é³å¢’ä¼¤èµå§æ®‡è§çƒ§ç»èµŠæ‘„æ…‘è®¾åæ» ç•²ç»…å®¡å©¶è‚¾æ¸—è¯œè°‚æ¸–å£°ç»³èƒœå¸ˆç‹®æ¹¿è¯—æ—¶èš€å®è¯†é©¶åŠ¿é€‚é‡Šé¥°è§†è¯•è°¥åŸ˜è³å¼‘è½¼è´³é“ˆé²¥å¯¿å…½ç»¶æ¢è¾“ä¹¦èµå±æœ¯æ ‘ç«–æ•°æ‘…çº¾å¸…é—©åŒè°ç¨é¡ºè¯´ç¡•çƒé“„ä¸é¥²å®é©·ç¼Œé”¶é¸¶è€¸æ€‚é¢‚è®¼è¯µæ“è–®é¦Šé£•é”¼è‹è¯‰è‚ƒè°¡ç¨£è™½éšç»¥å²è°‡å­™æŸç¬‹èªç‹²ç¼©çé”å”¢çƒç­æŒé—¼é“Šé³å°æ€é’›é²æ‘Šè´ªç˜«æ»©å›è°­è°ˆå¹æ˜™é’½é”¬é¡¸æ±¤çƒ«å‚¥é¥§é“´é•—æ¶›ç»¦è®¨éŸ¬é“½è…¾èªŠé”‘é¢˜ä½“å±‰ç¼‡é¹ˆé˜—æ¡ç²œé¾†é²¦è´´é“å…å¬çƒƒé“œç»Ÿæ¸å¤´é’­ç§ƒå›¾é’å›¢æŠŸé¢“èœ•é¥¨è„±é¸µé©®é©¼æ¤­ç®¨é¼è¢œå¨²è…½å¼¯æ¹¾é¡½ä¸‡çº¨ç»¾ç½‘è¾‹éŸ¦è¿å›´ä¸ºæ½ç»´è‹‡ä¼Ÿä¼ªçº¬è°“å«è¯¿å¸é—±æ²©æ¶ ç®éŸªç‚œé²”æ¸©é—»çº¹ç¨³é—®é˜Œç“®æŒèœ—æ¶¡çªå§è´é¾Œå‘œé’¨ä¹Œè¯¬æ— èŠœå´åé›¾åŠ¡è¯¯é‚¬åº‘æ€ƒå¦©éª›é¹‰é¹œé”¡ç‰ºè¢­ä¹ é“£æˆç»†é¥©é˜‹çºè§‹è™¾è¾–å³¡ä¾ ç‹­å¦å“ç¡–é²œçº¤è´¤è¡”é—²æ˜¾é™©ç°çŒ®å¿é¦…ç¾¡å®ªçº¿è‹‹è¶è—“å²˜çŒƒå¨´é¹‡ç—«èšç±¼è·¹å¢é•¶ä¹¡è¯¦å“é¡¹èŠ—é¥·éª§ç¼ƒé£¨è§åš£é”€æ™“å•¸å““æ½‡éªç»¡æ­ç®«åæŒŸæºèƒè°å†™æ³»è°¢äºµæ’·ç»ç¼¬é”Œè¡…å…´é™‰è¥å‡¶æ±¹é”ˆç»£é¦é¸ºè™šå˜˜é¡»è®¸å™ç»ªç»­è¯©é¡¼è½©æ‚¬é€‰ç™£ç»šè°–é“‰é•Ÿå­¦è°‘æ³¶é³•å‹‹è¯¢å¯»é©¯è®­è®¯é€ŠåŸ™æµ”é²Ÿå‹é¸¦é¸­å“‘äºšè®¶å­å¨…æ¡ æ°©é˜‰çƒŸç›ä¸¥å²©é¢œé˜è‰³åŒç šå½¦è°šéªŒå£èµä¿¨å…–è°³æ¹é—«é…½é­‡é¤é¼¹é¸¯æ¨æ‰¬ç–¡é˜³ç—’å…»æ ·ç‚€ç‘¶æ‘‡å°§é¥çª‘è°£è¯è½ºé¹é³çˆ·é¡µä¸šå¶é¥è°’é‚ºæ™”çƒ¨åŒ»é“±é¢é—ä»ªèšè‰ºäº¿å¿†ä¹‰è¯£è®®è°Šè¯‘å¼‚ç»è¯’å‘“å³„é¥´æ€¿é©¿ç¼¢è½¶è´»é’‡é•’é•±ç˜—èˆ£è«é˜´é“¶é¥®éšé“Ÿç˜¾æ¨±å©´é¹°åº”ç¼¨è¹è¤è¥è§è‡èµ¢é¢–èŒ”èºè¦è“¥æ’„å˜¤æ»¢æ½†ç’é¹¦ç˜¿é¢ç½‚å“Ÿæ‹¥ä½£ç—ˆè¸Šå’é•›ä¼˜å¿§é‚®é“€çŠ¹è¯±è¸é“•é±¿èˆ†é±¼æ¸”å¨±ä¸å±¿è¯­ç‹±èª‰é¢„é©­ä¼›ä¿£è°€è°•è“£åµ›é¥«é˜ˆå¦ªçº¡è§æ¬¤é’°é¹†é¹¬é¾‰é¸³æ¸Šè¾•å›­å‘˜åœ†ç¼˜è¿œæ©¼é¸¢é¼‹çº¦è·ƒé’¥ç²¤æ‚¦é˜…é’ºéƒ§åŒ€é™¨è¿è•´é…æ™•éŸµéƒ“èŠ¸æ½æ„ çº­éŸ«æ®’æ°²æ‚ç¾è½½æ”’æš‚èµç“’è¶±éŒ¾èµƒè„é©µå‡¿æ£è´£æ‹©åˆ™æ³½èµœå•§å¸»ç®¦è´¼è°®èµ ç»¼ç¼¯è½§é“¡é—¸æ …è¯ˆæ–‹å€ºæ¯¡ç›æ–©è¾—å´­æ ˆæˆ˜ç»½è°µå¼ æ¶¨å¸è´¦èƒ€èµµè¯é’Šè›°è¾™é”—è¿™è°ªè¾„é¹§è´é’ˆä¾¦è¯Šé•‡é˜µæµˆç¼œæ¡¢è½¸èµˆç¥¯é¸©æŒ£çç‹°äº‰å¸§ç—‡éƒ‘è¯è¯¤å³¥é’²é“®ç­ç»‡èŒæ‰§çº¸æŒšæ·å¸œè´¨æ»éª˜æ ‰æ €è½µè½¾è´½é¸·è›³çµ·è¸¬è¸¯è§¯é’Ÿç»ˆç§è‚¿ä¼—é”ºè¯Œè½´çš±æ˜¼éª¤çº£ç»‰çŒªè¯¸è¯›çƒ›ç©å˜±è´®é“¸é©»ä¼«æ§ é“¢ä¸“ç –è½¬èµšå•­é¦”é¢æ¡©åº„è£…å¦†å£®çŠ¶é”¥èµ˜å ç¼€éª“ç¼’è°†å‡†ç€æµŠè¯¼é•¯å…¹èµ„æ¸è°˜ç¼è¾èµ€çœ¦é”±é¾‡é²»è¸ªæ€»çºµå¬é‚¹è¯¹é©ºé²°è¯…ç»„é•é’»ç¼µèºœé³Ÿç¿±å¹¶åœæ²‰ä¸‘æ·€è¿­æ–—èŒƒå¹²çš‹ç¡…æŸœåä¼™ç§¸æ°è¯€å¤¸é‡Œå‡Œä¹ˆéœ‰æ»å‡„æ‰¦åœ£å°¸æŠ¬æ¶‚æ´¼å–‚æ±¡é”¨å’¸èå½æ¶Œæ¸¸åå¾¡æ„¿å²³äº‘ç¶æ‰æœ­ç­‘äºå¿—æ³¨å‡‹è® è°«éƒ„å‹å‡¼å‚å…å´åŸ¯åŸè‹˜è¬è®èœè¼è°è—æ¸å’å£å’”å’å’´å™˜å™¼åš¯å¹å²™åµ´å½·å¾¼çŠ¸ç‹é¦€é¦‡é¦“é¦•æ„£æ†·æ‡”ä¸¬æº†æ»Ÿæº·æ¼¤æ½´æ¾¹ç”¯çºŸç»”ç»±ç‰æ§æ¡Šæ¡‰æ§”æ©¥è½±è½·èµè‚·èƒ¨é£šç…³ç……ç†˜æ„æ·¼ç œç£™çœé’šé’·é“˜é“é”ƒé”é”é”é”˜é”é”ªé”«é”¿é•…é•é•¢é•¥é•©é•²ç¨†é¹‹é¹›é¹±ç–¬ç–´ç—–ç™¯è£¥è¥è€¢é¢¥è¨éº´é²…é²†é²‡é²é²´é²ºé²¼é³Šé³‹é³˜é³™é’é´é½„';
const T_CHARS = 'éŒ’çššè—¹ç¤™æ„›å™¯å¬¡ç’¦æ›–é„è«³éŠ¨éµªéª¯è¥–å¥§åª¼é©é°²å£©ç½·éˆ€æ“ºæ•—å”„é ’è¾¦çµ†éˆ‘å¹«ç¶éŠè¬—å‰é£½å¯¶å ±é®‘é´‡é½™è¼©è²é‹‡ç‹½å‚™æ†Šéµ¯è³éŒ›ç¹ƒç­†ç•¢æ–ƒå¹£é–‰è“½å—¶æ½·é‰ç¯³è¹•é‚Šç·¨è²¶è®Šè¾¯è¾®èŠç·¶ç±©æ¨™é©ƒé¢®é£†é¢é‘£é°¾é±‰åˆ¥ç™Ÿç€•æ¿±è³“æ“¯å„ç¹½æª³æ®¯è‡é‘Œé«•é¬¢é¤…ç¨Ÿæ’¥ç¼½é‰‘é§é¤‘éˆ¸éµ“è£œéˆ½è²¡åƒè ¶æ®˜æ…šæ…˜ç‡¦é©‚é»²è’¼è‰™å€‰æ»„å»å´å†Šæ¸¬æƒ»å±¤è©«é¤å„•é‡µæ”™æ‘»èŸ¬é¥è®’çºéŸç”¢é—¡é¡«å›…è«‚è®–è•†æ‡ºå¬‹é©è¦˜ç¦ªé”å ´å˜—é•·å„Ÿè…¸å» æš¢å€€è‡æ‚µé–¶é¯§éˆ”è»Šå¾¹ç¡¨å¡µé™³è¥¯å‚–è«¶æ«¬ç££é½”æ’ç¨±æ‡²èª é¨æ£–æª‰é‹®éºç™¡é²é¦³æ¥é½’ç†¾é£­é´Ÿæ²–è¡èŸ²å¯µéŠƒç–‡èºŠç±Œç¶¢å„”å¹¬è®æ«¥å»šé‹¤é››ç¤å„²è§¸è™•èŠ»çµ€èº•å‚³é‡§ç˜¡é—–å‰µæ„´éŒ˜ç¶ç´”é¶‰ç¶½è¼Ÿé½ªè¾­è©è³œé¶¿è°è”¥å›ªå¾å¢è“¯é©„æ¨…æ¹Šè¼³èº¥ç«„æ”›éŒ¯éŠ¼é¹ºé”å™ éŸƒå¸¶è²¸é§˜ç´¿æ“”å–®é„²æ’£è†½æ†šèª•å½ˆæ®«è³§ç™‰ç°ç•¶æ“‹é»¨è•©æª”è®œç¢­è¥ æ—å³¶ç¦±å°ç›œç‡¾ç‡ˆé„§é™æ•µæ»Œéç· ç³´è©†è«¦ç¶ˆè¦¿é‘é¡›é»å¢Šé›»å·”éˆ¿ç™²é‡£èª¿éŠšé¯›è«œç–Šé°ˆé‡˜é ‚éŒ è¨‚é‹Œä¸ŸéŠ©æ±å‹•æ£Ÿå‡å´ é¶‡ç«‡çŠ¢ç¨è®€è³­éç€†æ«ç‰˜ç¯¤é»·é›æ–·ç·ç±ªå…ŒéšŠå°æ‡Ÿé“å™¸é “éˆç‡‰èº‰å¥ªå¢®é¸éµé¡è¨›æƒ¡é¤“è«¤å Šé–¼è»›é‹¨é”é¶šé¡é¡“é±·èª’å…’çˆ¾é¤Œè²³é‚‡é‰ºé´¯é®ç™¼ç½°é–¥çºç¤¬é‡©ç…©è²©é£¯è¨ªç´¡éˆé­´é£›èª¹å»¢è²»ç·‹é¨é¯¡ç´›å¢³å¥®æ†¤ç³åƒ¨è±æ¥“é‹’é¢¨ç˜‹é¦®ç¸«è«·é³³çƒè†šè¼»æ’«è¼”è³¦å¾©è² è¨ƒå©¦ç¸›é³§é§™ç´±ç´¼è³»éº©é®’é°’é‡“è©²éˆ£è“‹è³…æ¡¿è¶•ç¨ˆè´›å°·æŸç´ºå²¡å‰›é‹¼ç¶±å´—æˆ‡é¬çªèª¥ç¸é‹¯æ“±é´¿é–£é‰»å€‹ç´‡é˜æ½çµ¦äº™è³¡ç¶†é¯é¾”å®®éè²¢é‰¤æºèŒæ§‹è³¼å¤ è©¬ç·±è¦¯è ±é¡§è©è½‚éˆ·éŒ®é´£éµ é¶»å‰®æ›é´°æ‘‘é—œè§€é¤¨æ…£è²«è©¿æ‘œé¸›é°¥å»£ç·è¦æ­¸é¾œé–¨è»Œè©­è²´åŠŠåŒ­åŠŒåª¯æªœé®­é±–è¼¥æ»¾è¢ç·„é¯€é‹åœ‹éå å’¼å¹—æ§¨èŸˆé‰¿é§­éŸ“æ¼¢é—çµé ¡è™Ÿçé¡¥é–¡é¶´è³€è¨¶é—”è £æ©«è½Ÿé´»ç´…é»Œè¨Œè‘’é–é±Ÿå£ºè­·æ»¬æˆ¶æ»¸é¶˜å˜©è¯ç•«åŠƒè©±é©Šæ¨ºéµæ‡·å£æ­¡ç’°é‚„ç·©æ›å–šç˜“ç…¥æ¸™å¥ç¹¯é°é¯‡é»ƒè¬Šé°‰æ®è¼æ¯€è³„ç©¢æœƒç‡´åŒ¯è«±èª¨ç¹ªè©¼è–ˆå™¦æ¾®ç¹¢ç¿æš‰è‘·æ¸¾è«¢é¤›é–½ç²è²¨ç¦éˆ¥é‘Šæ“Šæ©Ÿç©é¥‘è·¡è­é›ç¸¾ç·æ¥µè¼¯ç´šæ“ å¹¾è–ŠåŠ‘æ¿Ÿè¨ˆè¨˜éš›ç¹¼ç´€è¨è©°è–ºå˜°åšŒé©¥ç’£è¦¬é½ç£¯ç¾ˆè †èº‹éœ½é±­é¯½å¤¾è¢é °è³ˆé‰€åƒ¹é§•éƒŸæµ¹é‹éµèŸ¯æ®²ç›£å …ç®‹é–“è‰±ç·˜ç¹­æª¢å ¿é¹¼æ€æ’¿ç°¡å„‰æ¸›è–¦æª»é‘’è¸è³¤è¦‹éµè‰¦åŠé¤æ¼¸æ¿ºæ¾—è««ç¸‘æˆ”æˆ©ç¼é¶¼ç­§é°¹éŸ‰å°‡æ¼¿è”£æ§³çè¬›é†¬çµ³éŸè† æ¾†é©•å¬Œæ”ªé‰¸çŸ¯åƒ¥è…³é¤ƒç¹³çµè½è¼ƒæ’Ÿå¶ é·¦é®«éšç¯€æ½”çµèª¡å±†ç™¤é œé®šç·ŠéŒ¦åƒ…è¬¹é€²æ™‰ç‡¼ç›¡å‹èŠè–å·¹è—é¥‰ç¸‰è´è¦²é¯¨é©šç¶“é ¸éœé¡å¾‘ç—™ç«¶å‡ˆå‰„æ¶‡é€•å¼³è„›éšç³¾å»„èˆŠé¬®é³©é·²é§’èˆ‰æ“šé‹¸æ‡¼åŠ‡è©å±¨æ«¸é¢¶é‰…é‹¦çª¶é½Ÿéµ‘çµ¹éŒˆé«é›‹è¦ºæ±ºçµ•è­ç¨éˆè»é§¿çš¸é–‹å‡±å‰´å¡æ„¾æ„·é§é‡é¾•é–Œéˆ§éŠ¬é¡†æ®¼èª²é¨ç·™è»»éˆ³éŒé ·å¢¾æ‡‡é½¦é—æ‘³åº«è¤²åš³å¡Šå„ˆé„¶å™²è†¾å¯¬çªé«–ç¤¦æ› æ³èª†èª‘é„ºå£™çºŠè²ºè™§å·‹çªºé¥‹æ½°åŒ±è•¢æ†’èµç°£é–«éŒ•é¯¤æ“´é—Šè è Ÿè‡˜èŠä¾†è³´å´å¾ æ·¶ç€¨è³šçéŒ¸ç™©ç±Ÿè—æ¬„æ””ç±ƒé—Œè˜­ç€¾è®•æ”¬è¦½æ‡¶çºœçˆ›æ¿«åµæ¬–æ–•é‘­è¥¤ç‘¯é–¬é‹ƒæ’ˆå‹æ¾‡å˜®å¶—éŠ é’ç™†æ¨‚é°³é³å£˜é¡æ·šèª„ç¸²ç±¬è²é›¢é¯‰ç¦®éº—å²å‹µç¤«æ­·ç€éš¸å„·é…ˆå£¢è—¶è’è˜ºåš¦é‚é©ªç¸­æ«ªæ«Ÿè½¢ç¤ªé‹°é¸ç™˜ç³²èº’é‚é±ºé±§å€†è¯è“®é€£é®æ†æ¼£ç°¾æ–‚è‡‰éˆæˆ€ç…‰ç·´è˜å¥©ç€²ç’‰æ®®è¤³è¥é°±ç³§æ¶¼å…©è¼›è«’é­ç™‚é¼éç¹šé‡•é·¯çµè‡¨é„°é±—å‡œè³ƒè—ºå»©æªè½”èºªé½¡éˆ´éˆå¶ºé ˜ç¶¾æ¬èŸ¶é¯ªé¤¾åŠ‰ç€é¨®ç¶¹é¦é·šé¾è¾åš¨ç± å£Ÿæ”éš´è˜¢ç€§ç“æ«³æœ§ç¤±æ¨“å©æ‘Ÿç°åƒ‚è”å˜å¶é¤ç˜ºè€¬è»é«è˜†ç›§é¡±å»¬çˆæ“„é¹µè™œé­¯è³‚ç¥¿éŒ„é™¸å£šæ“¼åš•é–­ç€˜æ·¥æ«¨æ«“è½¤è¼…è½†æ°Œè‡šé¸•é·ºè‰«é±¸å·’æ”£å­¿ç¤äº‚è‡ å­Œæ¬’é¸é‘¾æ„è¼ªå€«ä¾–æ·ªç¶¸è«–åœ‡è˜¿ç¾…é‚é‘¼ç±®é¨¾é§±çµ¡çŠ–ç€æ¿¼æ¬è…¡éé©¢å‘‚é‹ä¾¶å±¢ç¸·æ…®æ¿¾ç¶ æ«šè¤¸é‹å˜¸åª½ç‘ªç¢¼èé¦¬ç½µå—å˜œå¬¤æ¦ªè²·éº¥è³£é‚è„ˆå‹±çé¥…è »æ»¿è¬¾ç¸µéé¡™é°»è²“éŒ¨é‰šè²¿éº¼æ²’é‚é–€æ‚¶å€‘æ«ç‡œæ‡£é†éŒ³å¤¢ç‡è¬å½Œè¦“å†ªç¾‹è¬ç¼ç¦°ç¶¿ç·¬æ¾ é¦é»½å»Ÿç·²ç¹†æ»…æ†«é–©é–”ç·¡é³´éŠ˜è¬¬è¬¨é©€é¥ƒæ­¿éŒè¬€ç•é‰¬å¶éˆ‰ç´é›£æ’“è…¦æƒ±é¬§éƒè¨¥é¤’å…§æ“¬è†©éˆ®é¯¢æ”†è¼¦é¯°é‡€é³¥è”¦è£Šè¶åš™é‘·é³éš‰è˜—å›é¡¢èº¡æª¸ç°å¯§æ“°æ¿˜è‹§åš€è¹éˆ•ç´è†¿æ¿ƒè¾²å„‚å™¥é§‘é‡¹è«¾å„ºç˜§æ­é·—æ¯†å˜”æ¼šè¬³æ…ªç”Œç›¤è¹£é¾æ‹‹çš°è³ è½¡å™´éµ¬ç´•ç¾†éˆ¹é¨™è«é§¢é£„ç¸¹é »è²§å¬ªè˜‹æ†‘è©•æ½‘é —é‡™æ’²é‹ªæ¨¸è­œé·é æ£²è‡é½Šé¨è±ˆå•Ÿæ°£æ£„è¨–è˜„é¨ç¶ºæ¦¿ç£§é é é°­ç‰½é‡¬é‰›é·ç°½è¬™éŒ¢é‰—æ½›æ·ºè­´å¡¹åƒ‰è•æ…³é¨«ç¹¾æ§§éˆæ§å—†å¢»è–”å¼·æ¶å¬™æª£æˆ§ç†—éŒ†é˜é¹ç¾¥è¹Œé¬æ©‹å–¬åƒ‘ç¿¹ç«…èªšè­™è•ç¹°ç£½è¹ºç«Šæ„œé¥ç¯‹æ¬½è¦ªå¯¢é‹Ÿè¼•æ°«å‚¾é ƒè«‹æ…¶æ’³é¯–ç“Šçª®ç…¢è›ºå·°è³•èŸ£é°è¶¨å€è»€é©…é½²è©˜å¶‡é—ƒè¦·é´é¡´æ¬Šå‹¸è©®ç¶£è¼‡éŠ“å»éµ²ç¢ºé—‹é—•æ„¨è®“é¥’æ“¾ç¹è•˜å¬ˆæ©ˆç†±éŸŒèªç´‰é£ªè»”æ¦®çµ¨å¶¸è ‘ç¸ŸéŠ£é¡°è»ŸéŠ³èœ†é–æ½¤ç‘è–©é¢¯é°“è³½å‚˜æ¯¿ç³å–ªé¨·æƒç¹…æ¾€å—‡éŠ«ç©¡æ®ºå‰ç´—é©é¯Šç¯©æ›¬é‡ƒåˆªé–ƒé™œè´ç¹•è¨•å§é¨¸é‡¤é±”å¢‘å‚·è³å°æ®¤è§´ç‡’ç´¹è³’æ”æ‡¾è¨­å™ç„ç•¬ç´³å¯©å¬¸è…æ»²è©µè«—ç€‹è²ç¹©å‹å¸«ç…æ¿•è©©æ™‚è•å¯¦è­˜é§›å‹¢é©é‡‹é£¾è¦–è©¦è¬šå¡’è’”å¼’è»¾è²°éˆ°é°£å£½ç¸ç¶¬æ¨è¼¸æ›¸è´–å±¬è¡“æ¨¹è±æ•¸æ”„ç´“å¸¥é–‚é›™èª°ç¨…é †èªªç¢©çˆé‘ çµ²é£¼å»é§Ÿç·¦é¶é·¥è³æ…«é Œè¨Ÿèª¦æ“»è—ªé¤¿é¢¼éªè˜‡è¨´è‚…è¬–ç©Œé›–éš¨ç¶æ­²èª¶å­«æç­è“€çŒ»ç¸®ç‘£é–å—©è„§çºæ’»é—¥é‰ˆé°¨è‡ºæ…‹éˆ¦é®æ”¤è²ªç™±ç˜å£‡è­šè«‡å˜†æ›‡é‰­éŒŸé ‡æ¹¯ç‡™å„»é¤³é‹éœæ¿¤çµ³è¨éŸœé‹±é¨°è¬„éŠ»é¡Œé«”å±œç·¹éµœé—æ¢ç³¶é½ é°·è²¼éµå»³è½çƒ´éŠ…çµ±æ…Ÿé ­éˆ„ç¦¿åœ–é‡·åœ˜æ‘¶é ¹è›»é£©è„«é´•é¦±é§æ©¢ç±œé¼‰è¥ªåª§è†ƒå½ç£é ‘è¬ç´ˆç¶°ç¶²è¼éŸ‹é•åœç‚ºæ¿°ç¶­è‘¦å‰å½ç·¯è¬‚è¡›è«‰å¹ƒé—ˆæºˆæ½¿ç‘‹éŸ™ç…’é®ªæº«èç´‹ç©©å•é–¿ç”•æ’¾è¸æ¸¦çª©è‡¥èµé½·å—šé¢çƒèª£ç„¡è•ªå³å¡¢éœ§å‹™èª¤é„”å»¡æ†®å«µé¨–éµ¡é¶©éŒ«çŠ§è¥²ç¿’éŠ‘æˆ²ç´°é¤¼é¬©ç’½è¦¡è¦è½„å³½ä¿ ç‹¹å»ˆåš‡ç¡¤é®®çº–è³¢éŠœé–‘é¡¯éšªç¾ç»ç¸£é¤¡ç¾¨æ†²ç·šè§è–Ÿè˜šå³´ç«å«»é·´ç™‡è ”ç§ˆèºšå»‚é‘²é„‰è©³éŸ¿é …è–Œé¤‰é©¤ç·—é¥—è•­å›‚éŠ·æ›‰å˜¯å˜µç€Ÿé©ç¶ƒæ¢Ÿç°«å”æŒ¾æ”œè„…è«§å¯«ç€‰è¬è¤»æ“·ç´²çºˆé‹…é‡èˆˆé™˜æ»å…‡æ´¶éŠ¹ç¹¡é¥ˆéµ‚è™›å™“é ˆè¨±æ•˜ç·’çºŒè©¡é Šè»’æ‡¸é¸ç™¬çµ¢è«¼é‰‰é‡å­¸è¬”æ¾©é±ˆå‹›è©¢å°‹é¦´è¨“è¨Šéœå¡¤æ½¯é±˜å£“é´‰é´¨å•äºè¨åŸ¡å©­æ¤æ°¬é–¹ç…™é¹½åš´å·–é¡é–»è‰·å­ç¡¯å½¥è«ºé©—å´è´—å„¼å…—è®æ‡¨é–†é‡…é­˜é¥œé¼´é´¦æ¥Šæšç˜é™½ç™¢é¤Šæ¨£ç…¬ç‘¤æ–å ¯é™çª¯è¬ è—¥è»ºé·‚é°©çˆºé æ¥­è‘‰é¨è¬é„´æ›„ç‡é†«éŠ¥é ¤éºå„€èŸ»è—å„„æ†¶ç¾©è©£è­°èª¼è­¯ç•°ç¹¹è©’å›ˆå¶§é£´æ‡Œé©›ç¸Šè»¼è²½é‡”é°é¿ç˜è‰¤è”­é™°éŠ€é£²éš±éŠ¦ç™®æ«»å¬°é·¹æ‡‰çº“ç‘©è¢ç‡Ÿç†’è …è´ç©å¡‹é¶¯ç¸ˆé£æ”–åš¶ç€…ç€ ç“”é¸šç™­é ¦ç½Œå–²æ“å‚­ç™°è¸´è© éå„ªæ†‚éƒµéˆ¾çŒ¶èª˜è••éŠªé­·è¼¿é­šæ¼å¨›èˆ‡å¶¼èªç„è­½é é¦­å‚´ä¿è«›è«­è•·å´³é£«é–¾å«—ç´†è¦¦æ­Ÿéˆºéµ’é·¸é½¬é´›æ·µè½…åœ’å“¡åœ“ç·£é æ«é³¶é»¿ç´„èºé‘°ç²µæ‚…é–±é‰é„–å‹»éš•é‹è˜Šé†æšˆéŸ»é„†è•“æƒ²æ…ç´œéŸæ®æ°³é›œç½è¼‰æ”¢æš«è´Šç“šè¶²é¨è´“è‡Ÿé§”é‘¿æ£—è²¬æ“‡å‰‡æ¾¤è³¾å˜–å¹˜ç°€è³Šè­–è´ˆç¶œç¹’è»‹é˜é–˜æŸµè©é½‹å‚µæ°ˆç›æ–¬è¼¾å¶„æ£§æˆ°ç¶»è­«å¼µæ¼²å¸³è³¬è„¹è¶™è©”é‡—èŸ„è½éºé€™è¬«è¼’é·“è²é‡åµè¨ºé®é™£æ¹ç¸æ¥¨è»«è³‘ç¦é´†æ™çœçŒ™çˆ­å¹€ç™¥é„­è­‰è«å´¢é‰¦éŒšç®ç¹”è·åŸ·ç´™æ‘¯æ“²å¹Ÿè³ªæ»¯é¨­æ«›æ¢”è»¹è¼Šè´„é·™è„ç¸¶èº“èº‘è§¶é˜çµ‚ç¨®è…«çœ¾é¾è¬…è»¸çšºæ™é©Ÿç´‚ç¸è±¬è«¸èª…ç‡­çŸšå›‘è²¯é‘„é§ä½‡æ«§éŠ–å°ˆç£šè½‰è³ºå›€é¥Œé¡³æ¨èŠè£å¦å£¯ç‹€éŒè´…å¢œç¶´é¨…ç¸‹è«„æº–è‘—æ¿è«‘é²èŒ²è³‡æ¼¬è«®ç·‡è¼œè²²çœ¥éŒ™é½œé¯”è¹¤ç¸½ç¸±å‚¯é„’è«é¨¶é¯«è©›çµ„éƒé‰†çº˜èº¦é±’ç¿ºä¸¦è””æ²ˆé†œæ¾±å é¬¥ç¯„å¹¹è‡¯çŸ½æ«ƒå¾Œå¤¥ç¨­å‚‘è¨£èª‡è£æ·©éº½é»´æ’šæ·’æ‰¡è–å±æ“¡å¡—çªªé¤µæ±™éé¹¹è å½œæ¹§éŠç±²ç¦¦é¡˜å¶½é›²ç«ˆç´®åŠ„ç¯‰æ–¼èªŒè¨»é›•è¨è­¾éƒ¤çŒ›æ°¹é˜ªå£Ÿå –åµå¢Šæª¾è•’è‘¤è“§è’“è‡æ§æ‘£å’¤å”šå“¢å™å™…æ’…åŠˆè¬”è¥†å¶´è„Šä»¿åƒ¥çéº…é¤˜é¤·é¥Šé¥¢æ¥æ€µæ‡çˆ¿æ¼µç©æ··æ¿«ç€¦æ·¡å¯§ç³¸çµç·”ç‘‰æ¢˜æ£¬æ¡ˆæ©°æ««è»²è»¤è³«è†è…–é£ˆç³Šç…†æºœæ¹£æ¸ºç¢¸æ»¾ç˜éˆˆé‰•é‹£éŠ±é‹¥é‹¶é¦é§é©é€éƒéŒ‡é„é‡é¿éé‘¥é‘¹é‘”ç©­é¶“é¶¥é¸Œç™§å±™ç˜‚è‡’è¥‡ç¹ˆè€®é¡¬èŸéº¯é®é®ƒé®é¯—é¯é¯´é±é¯¿é° é°µé±…é½éŸé½‡';

const regionMap = {"ä¸­è¯æ°‘åœ‹":"å°æ¹¾","ä¸­åæ°‘å›½":"å°æ¹¾","ä¿„ç½—æ–¯è”é‚¦":"ä¿„ç½—æ–¯","å¾·æ„å¿—è”é‚¦å…±å’Œå›½":"å¾·å›½","Libya":"åˆ©æ¯”äºš","Dubai":"è¿ªæ‹œ","Fujairah":"å¯ŒæŸ¥ä¼Šæ‹‰","ImÄrat Umm al Qaywayn":"ä¹Œå§†ç›–ä¸‡","FÃ¨s-MeknÃ¨s":"éæ–¯-æ¢…å…‹å†…æ–¯","Tirana":"åœ°æ‹‰é‚£","Vienna":"ç»´ä¹Ÿçº³","new south wales":"æ–°å—å¨å°”å£«","New South Wales":"æ–°å—å¨å°”å£«","Victoria":"ç»´å¤šåˆ©äºš","Buenos Aires F.D.":"å¸ƒå®œè¯ºæ–¯è‰¾åˆ©æ–¯","Baku City":"å·´åº“","Lankaran Rayon":"è¿ç§‘å…°","å¸ƒé²å¡å°”é¦–éƒ½å¤§åŒº":"å¸ƒé²å¡å°”","Sofia-Capital":"ç´¢éäºš","Sao Paulo":"åœ£ä¿ç½—","Ontario":"å®‰å¤§ç•¥","Quebec":"é­åŒ—å…‹","Zurich":"è‹é»ä¸–","åœ£åœ°äºšå“¥é¦–éƒ½å¤§åŒº":"åœ£åœ°äºšå“¥","Bogota D.C.":"æ³¢å“¥å¤§","Provincia de San JosÃ©":"åœ£ä½•å¡","è‡ºåŒ—å¸‚":"å°åŒ—","è‡ºç£çœ or å°ç£çœ":"å°åŒ—","Taiwan":"å°æ¹¾","Changhua":"å½°åŒ–","Taichung City":"å°ä¸­","Taoyuan":"æ¡ƒå›­","Yunlin":"äº‘æ—","Havana":"å“ˆç“¦é‚£","Prague":"å¸ƒæ‹‰æ ¼","çŸ³å‹’è‹ç›Šæ ¼-è·å°”æ–¯æ³°å› ":"çŸ³è·å·","Hesse":"é»‘æ£®","Capital Region":"å“¥æœ¬å“ˆæ ¹","Catalonia":"åŠ æ³°ç½—å°¼äºš","Madrid":"é©¬å¾·é‡Œ","æ³•å…°è¥¿å²›":"æ³•å…°è¥¿å²›","å¥§å¼—æ¶…-ç¾…è¨¥-é˜¿çˆ¾å‘æ–¯å¤§å€":"å¥¥ç½—é˜¿å¤§åŒº","æ™®ç½—æ—ºæ–¯-é˜¿å°”å‘æ–¯-è”šè“æµ·å²¸å¤§åŒº":"æ™®é˜¿è“å¤§åŒº","Ãle-de-France":"æ³•å…°è¥¿å²›","City of Zagreb":"è¨æ ¼å‹’å¸ƒ","Wales":"å¨å°”å£«","Sermersooq":"ç‘Ÿé»˜ç´¢å…‹","Attica":"é˜¿æå¡","Greater Accra Region":"å¤§é˜¿å…‹æ‹‰","Kowloon":"ä¹é¾™","Wong Tai Sin":"é»„å¤§ä»™åŒº","Sai Kung District":"è¥¿è´¡åŒº","Sham Shui Po":"æ·±æ°´åŸ—åŒº","Tsuen Wan District":"èƒæ¹¾åŒº","Budapest":"å¸ƒè¾¾ä½©æ–¯","Jakarta":"é›…åŠ è¾¾","Tel Aviv":"ç‰¹æ‹‰ç»´å¤«","National Capital Territory of Delhi":"å¾·é‡Œ","Southern Peninsula":"é›·å…‹é›…æœªå…‹","Lombardy":"ä¼¦å·´ç¬¬","Lazio":"æ‹‰é½å¥¥","Tokyo":"ä¸œäº¬éƒ½","Osaka":"å¤§é˜ªåºœ","ÅŒsaka":"å¤§é˜ªåºœ","Mto Panga":"å§†æ‰˜æ½˜åŠ ","Daegu":"å¤§é‚±","Gangwon-do":"æ±ŸåŸé“","Jeollabuk-do":"å…¨ç½—åŒ—é“","Incheon":"ä»å·","North Chungcheong":"å¿ æ¸…åŒ—é“","Phnom Penh":"é‡‘è¾¹","Almaty":"é˜¿æ‹‰æœ¨å›¾","Almaty Oblysy":"é˜¿æ‹‰æœ¨å›¾","Aqmola":"é˜¿å…‹è«æ‹‰","Astana":"é˜¿æ–¯å¡”çº³","Zhambyl Oblysy":"æ±Ÿå¸ƒå°”","Diekirch":"è¿ªåŸºå¸Œ","Luxembourg":"å¢æ£®å ¡","RÄ«ga":"é‡ŒåŠ ","Shaâ€˜bÄ«yat BanghÄzÄ«":"ç­åŠ è¥¿","ChiÈ™inÄƒu Municipality":"åŸºå¸Œè®·ä¹Œ","Grand Port District":"å¤§æ¸¯åŒº","Kuala Lumpur":"å‰éš†å¡","Ulaanbaatar":"ä¹Œå…°å·´æ‰˜","Lagos":"æ‹‰å„æ–¯","North Holland":"åŒ—è·å…°","Oslo County":"å¥¥æ–¯é™†","Viken":"ç»´è‚¯éƒ¡","Bagmati Province":"å·´æ ¼é©¬è’‚","Muscat":"é©¬æ–¯å–€ç‰¹","Metro Manila":"é©¬å°¼æ‹‰","Northern Mindanao":"åŒ—æ£‰å…°è€","Mazovia":"é©¬ä½å¤«èˆ","Belgrade":"è´å°”æ ¼è±å¾·","Moscow":"è«æ–¯ç§‘","St.-Petersburg":"åœ£å½¼å¾—å ¡","Tatarstan Republic":"é‘é¼æ–¯å¦","BucureÈ™ti":"å¸ƒåŠ å‹’æ–¯ç‰¹","Mecca Region":"éº¦åŠ ","Honiara":"éœå°¼äºšæ‹‰","Stockholm":"æ–¯å¾·å“¥å°”æ‘©","Stockholm County":"æ–¯å¾·å“¥å°”æ‘©","Central Singapore":"æ–°åŠ å¡ä¸­åŒº","North West":"æ–°åŠ å¡è¥¿åŒ—","North East":"æ–°åŠ å¡ä¸œåŒ—","South West":"æ–°åŠ å¡è¥¿å—","South East":"æ–°åŠ å¡ä¸œå—","Banaadir":"ç­çº³è¿ªå°”","Zanzibar Urban/West":"æ¡‘ç»™å·´å°”","Ang Thong":"çº¢ç»Ÿåºœ","Kyiv City":"åŸºè¾…","åŠ å·":"åŠ åˆ©ç¦å°¼äºš","éº»è–©è«¸å¡å·":"é©¬è¨è¯¸å¡","Arizona":"äºšåˆ©æ¡‘é‚£","Miranda":"ç±³å…°è¾¾","Hanoi":"æ²³å†…","HÃ²a BÃ¬nh Province":"å’Œå¹³çœ","Háº£i DÆ°Æ¡ng Province":"æµ·é˜³çœ","Ho Chi Minh City (HCMC)":"èƒ¡å¿—æ˜å¸‚","Hai Phong":"æµ·é˜²","Da Nang City":"å²˜æ¸¯"};

// --- 1. å­—å…¸å¤„ç†å·¥å…· ---
function processField(str) {
  if (!str) return "";
  let result = "";
  for (const char of String(str)) {
    const idx = T_CHARS.indexOf(char);
    result += (idx !== -1 ? S_CHARS[idx] : char);
  }
  return result.trim();
}

// --- 2. æ•°æ®è·å– ---
async function fetchAllData() {
  try {
    const geoReq = new Request(geoUrl);
    geoReq.timeoutInterval = 10;
    const geo = await geoReq.loadJSON().catch(() => null);
    if (!geo || geo.status !== "success") return null;

    const targetIP = geo.query;

    // WebView æŠ“å–
    let wv = new WebView();
    await wv.loadURL(`https://ippure.com/?ip=${targetIP}`);
    await new Promise(r => {
      let t = new Timer();
      t.timeInterval = 7000; 
      t.schedule(r);
    });

    const risk = await wv.evaluateJavaScript(`
      function scrape() {
        const text = document.body.innerText;
        const lines = text.split('\\n').map(l => l.trim());
        function getVal(key) {
          const idx = lines.findIndex(l => l.includes(key));
          if (idx !== -1) {
            for (let i = idx + 1; i < idx + 5; i++) {
              if (lines[i] && lines[i].length > 1) return lines[i];
            }
          }
          return "æœªçŸ¥";
        }
        return {
          score: parseInt(getVal("IPPureç³»æ•°").match(/\\d+/)?.[0] || "0"),
          type: getVal("IPå±æ€§"),
          source: getVal("IPæ¥æº")
        };
      }
      scrape();
    `);

    const score = risk.score;
    const thresholds = [0, 15, 25, 40, 50, 70, 100];
    const segmentH = 17;
    let totalH = 0;

    for (let i = 0; i < 6; i++) {
      let low = thresholds[i];
      let up = thresholds[i+1];
      
      if (score >= up) {
        totalH += segmentH;
      } else if (score > low) {
        totalH += (score - low) / (up - low) * segmentH;
        break;
      } else {
        break; 
      }
    }

    // æ ¼å¼åŒ–åœ°ç†ä½ç½®
    let country = processField(regionMap[geo.country] || geo.country);
    let region = processField(regionMap[geo.regionName] || geo.regionName);
    let finalLocation = (country.includes(region) || region.includes(country) || country === region || !region) 
                        ? country : `${country} ${region}`;

    return {
      ip: targetIP,
      location: finalLocation.toUpperCase(),
      isp: processField(geo.isp) || geo.isp,
      asn: geo.as ? geo.as.split(' ')[0] : "AS----",
      countryCode: geo.countryCode,
      fraudScore: score,
      barHeight: totalH,
      isResidential: risk.type.includes("ä½å®…"),
      isBroadcast: risk.source.includes("åŸç”Ÿ")
    };
  } catch (e) {
    console.log("æ•°æ®åŠ è½½å¤±è´¥: " + e);
    return null;
  }
}

// --- 3. é˜¶æ¢¯å †å ç®—æ³• ---
function getStackedGradient(score) {
  const thresholds = [0, 15, 25, 40, 50, 70, 100];
  const allColors = ["#166534", "#22C55E", "#84CC16", "#EAB308", "#F97316", "#FF3B30"];
  
  let colors = [];
  let locations = [];
  const segmentHeight = 1 / 6;

  for (let i = 0; i < 6; i++) {
    let lower = thresholds[i];
    let upper = thresholds[i+1];
    let fillInSegment = 0;
    if (score > lower) {
      fillInSegment = Math.min((score - lower) / (upper - lower), 1);
    }
    
    if (fillInSegment > 0) {
      let color = new Color(allColors[i]);
      let startPos = i * segmentHeight;
      let endPos = startPos + (fillInSegment * segmentHeight);
      colors.push(color, color);
      locations.push(startPos, endPos);
    }
  }

  if (colors.length === 0) {
    return { colors: [new Color("#166534", 0.2), new Color("#166534", 0.2)], locations: [0, 1] };
  }

  return {
    colors: colors.reverse(),
    locations: locations.reverse().map(l => 1 - l)
  };
}

// --- 4. UI æ¸²æŸ“ ---
async function createWidget(data) {
  let w = new ListWidget();
  const padding = 12;
  w.setPadding(padding, padding, padding, padding); 
  
  const isDark = Device.isUsingDarkAppearance();
  const mainColor = isDark ? Color.white() : Color.black();
  const pillBg = isDark ? new Color("#3a3a3c", 0.6) : new Color("#e5e5ea", 0.9);

  let bgGradient = new LinearGradient();
  bgGradient.colors = isDark 
    ? [new Color("#1c1c1e"), new Color("#000000")] 
    : [new Color("#f2f2f7"), new Color("#ffffff")];
  w.backgroundGradient = bgGradient;

  if (!data) return w;

  w.addSpacer();

  // Header
  let header = w.addStack();
  header.centerAlignContent();
  header.addText(getFlagEmoji(data.countryCode)).font = Font.systemFont(20);
  header.addSpacer(6);
  let locText = header.addText(data.location); 
  locText.font = Font.heavySystemFont(13);
  locText.textColor = mainColor;
  locText.lineLimit = 1;
  header.addSpacer();

  w.addSpacer(10); 

  // Content Area
  let contentArea = w.addStack();
  contentArea.layoutHorizontally();
  contentArea.centerAlignContent();

  const rowGap = 5;          
  const infoRowHeight = 21.75;
  const barWidth = 6;        
  const totalBarHeight = 102;

  const thresholds_logic = [0, 15, 25, 40, 50, 70, 100];
  let filledSegmentsCount = 0;
  for (let i = 0; i < 6; i++) {
    if (data.fraudScore > thresholds_logic[i]) {
      filledSegmentsCount += Math.min((data.fraudScore - thresholds_logic[i]) / (thresholds_logic[i+1] - thresholds_logic[i]), 1);
    }
  }

  // Risk Bar å¤–å£³
  let riskContainer = contentArea.addStack();
  riskContainer.size = new Size(barWidth, totalBarHeight);
  riskContainer.cornerRadius = 3;
  riskContainer.backgroundColor = isDark ? new Color("#121212", 0.7) : new Color("#121212", 0.7); 
  riskContainer.layoutVertically();
  riskContainer.addSpacer();

  // å†…éƒ¨è¿›åº¦æ¡
  let progressBar = riskContainer.addStack();
  progressBar.size = new Size(barWidth, data.barHeight); 
  progressBar.cornerRadius = 3;
  progressBar.borderWidth = 0.5;
  progressBar.borderColor = new Color("#FFFFFF", 0.35);

  let g = new LinearGradient();
  let gd = getStackedGradient(data.fraudScore);
  g.colors = gd.colors;
  g.locations = gd.locations;
  progressBar.backgroundGradient = g;

  contentArea.addSpacer(10); 

  // Info Pills
  let infoCol = contentArea.addStack();
  infoCol.layoutVertically();
  const infoWidth = 117; 

  const addPill = (text, fontSize) => {
    let p = infoCol.addStack();
    p.size = new Size(infoWidth, infoRowHeight);
    p.backgroundColor = pillBg;
    p.cornerRadius = 6;
    p.centerAlignContent();
    p.setPadding(0, 3, 0, 3);
    
    let t = p.addText(text);
    t.font = Font.boldSystemFont(fontSize);
    t.textColor = mainColor;
    t.lineLimit = 1;
    t.minimumScaleFactor = 0.5;
  };

  addPill(data.ip, 10);
  infoCol.addSpacer(rowGap);
  addPill(data.asn, 10);
  infoCol.addSpacer(rowGap);
  addPill(data.isp.toUpperCase(), 10);
  infoCol.addSpacer(rowGap);

  let lastRow = infoCol.addStack();
  lastRow.layoutHorizontally();
  const smallWidth = (infoWidth - rowGap) / 2;
  const createTag = (text) => {
    let tag = lastRow.addStack();
    tag.size = new Size(smallWidth, infoRowHeight);
    tag.backgroundColor = pillBg;
    tag.cornerRadius = 6;
    tag.centerAlignContent();
    let st = tag.addText(text);
    st.font = Font.boldSystemFont(8.5);
    st.textColor = mainColor;
  };

  createTag(data.isBroadcast ? "åŸç”Ÿ IP" : "å¹¿æ’­ IP");
  lastRow.addSpacer(rowGap);
  createTag(data.isResidential ? "ä½å®… IP" : "æœºæˆ¿ IP");

  w.addSpacer(); 
  return w;
}

// --- 5. å·¥å…·å‡½æ•°ä¸æ‰§è¡Œ ---
function getFlagEmoji(c) {
  return c ? c.toUpperCase().replace(/./g, x => String.fromCodePoint(127397 + x.charCodeAt())) : "ğŸŒ";
}

const data = await fetchAllData();
let widget = await createWidget(data);
if (!config.runsInWidget) await widget.presentSmall();
Script.setWidget(widget);
Script.complete();
