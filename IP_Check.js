if ($response.statusCode != 200) {
  $done(null);
}
// 国家代码到国旗的映射表
const flags = new Map([["AC", "🇦🇨"], ["AD", "🇦🇩"], ["AE", "🇦🇪"], ["AF", "🇦🇫"], ["AG", "🇦🇬"], ["AI", "🇦🇮"], ["AL", "🇦🇱"], ["AM", "🇦🇲"], ["AO", "🇦🇴"], ["AQ", "🇦🇶"], ["AR", "🇦🇷"], ["AS", "🇦🇸"], ["AT", "🇦🇹"], ["AU", "🇦🇺"], ["AW", "🇦🇼"], ["AX", "🇦🇽"], ["AZ", "🇦🇿"], ["BA", "🇧🇦"], ["BB", "🇧🇧"], ["BD", "🇧🇩"], ["BE", "🇧🇪"], ["BF", "🇧🇫"], ["BG", "🇧🇬"], ["BH", "🇧🇭"], ["BI", "🇧🇮"], ["BJ", "🇧🇯"], ["BM", "🇧🇲"], ["BN", "🇧🇳"], ["BO", "🇧🇴"], ["BR", "🇧🇷"], ["BS", "🇧🇸"], ["BT", "🇧🇹"], ["BV", "🇧🇻"], ["BW", "🇧🇼"], ["BY", "🇧🇾"], ["BZ", "🇧🇿"], ["CA", "🇨🇦"], ["CD", "🇨🇩"], ["CF", "🇨🇫"], ["CG", "🇨🇬"], ["CH", "🇨🇭"], ["CI", "🇨🇮"], ["CK", "🇨🇰"], ["CL", "🇨🇱"], ["CM", "🇨🇲"], ["CN", "🇨🇳"], ["CO", "🇨🇴"], ["CP", "🇨🇵"], ["CR", "🇨🇷"], ["CU", "🇨🇺"], ["CV", "🇨🇻"], ["CW", "🇨🇼"], ["CX", "🇨🇽"], ["CY", "🇨🇾"], ["CZ", "🇨🇿"], ["DE", "🇩🇪"], ["DG", "🇩🇬"], ["DJ", "🇩🇯"], ["DK", "🇩🇰"], ["DM", "🇩🇲"], ["DO", "🇩🇴"], ["DZ", "🇩🇿"], ["EA", "🇪🇦"], ["EC", "🇪🇨"], ["EE", "🇪🇪"], ["EG", "🇪🇬"], ["EH", "🇪🇭"], ["ER", "🇪🇷"], ["ES", "🇪🇸"], ["ET", "🇪🇹"], ["EU", "🇪🇺"], ["FI", "🇫🇮"], ["FJ", "🇫🇯"], ["FK", "🇫🇰"], ["FM", "🇫🇲"], ["FO", "🇫🇴"], ["FR", "🇫🇷"], ["GA", "🇬🇦"], ["GB", "🇬🇧"], ["GD", "🇬🇩"], ["GE", "🇬🇪"], ["GF", "🇬🇫"], ["GH", "🇬🇭"], ["GI", "🇬🇮"], ["GL", "🇬🇱"], ["GM", "🇬🇲"], ["GN", "🇬🇳"], ["GP", "🇬🇵"], ["GR", "🇬🇷"], ["GT", "🇬🇹"], ["GU", "🇬🇺"], ["GW", "🇬🇼"], ["GY", "🇬🇾"], ["HK", "🇭🇰"], ["HN", "🇭🇳"], ["HR", "🇭🇷"], ["HT", "🇭🇹"], ["HU", "🇭🇺"], ["ID", "🇮🇩"], ["IE", "🇮🇪"], ["IL", "🇮🇱"], ["IM", "🇮🇲"], ["IN", "🇮🇳"], ["IR", "🇮🇷"], ["IS", "🇮🇸"], ["IT", "🇮🇹"], ["JM", "🇯🇲"], ["JO", "🇯🇴"], ["JP", "🇯🇵"], ["KE", "🇰🇪"], ["KG", "🇰🇬"], ["KH", "🇰🇭"], ["KI", "🇰🇮"], ["KM", "🇰🇲"], ["KN", "🇰🇳"], ["KP", "🇰🇵"], ["KR", "🇰🇷"], ["KW", "🇰🇼"], ["KY", "🇰🇾"], ["KZ", "🇰🇿"], ["LA", "🇱🇦"], ["LB", "🇱🇧"], ["LC", "🇱🇨"], ["LI", "🇱🇮"], ["LK", "🇱🇰"], ["LR", "🇱🇷"], ["LS", "🇱🇸"], ["LT", "🇱🇹"], ["LU", "🇱🇺"], ["LV", "🇱🇻"], ["LY", "🇱🇾"], ["MA", "🇲🇦"], ["MC", "🇲🇨"], ["MD", "🇲🇩"], ["MG", "🇲🇬"], ["MH", "🇲🇭"], ["MK", "🇲🇰"], ["ML", "🇲🇱"], ["MM", "🇲🇲"], ["MN", "🇲🇳"], ["MO", "🇲🇴"], ["MP", "🇲🇵"], ["MQ", "🇲🇶"], ["MR", "🇲🇷"], ["MS", "🇲🇸"], ["MT", "🇲🇹"], ["MU", "🇲🇺"], ["MV", "🇲🇻"], ["MW", "🇲🇼"], ["MX", "🇲🇽"], ["MY", "🇲🇾"], ["MZ", "🇲🇿"], ["NA", "🇳🇦"], ["NC", "🇳🇨"], ["NE", "🇳🇪"], ["NF", "🇳🇫"], ["NG", "🇳🇬"], ["NI", "🇳🇮"], ["NL", "🇳🇱"], ["NO", "🇳🇴"], ["NP", "🇳🇵"], ["NR", "🇳🇷"], ["NZ", "🇳🇿"], ["OM", "🇴🇲"], ["PA", "🇵🇦"], ["PE", "🇵🇪"], ["PF", "🇵🇫"], ["PG", "🇵🇬"], ["PH", "🇵🇭"], ["PK", "🇵🇰"], ["PL", "🇵🇱"], ["PM", "🇵🇲"], ["PR", "🇵🇷"], ["PS", "🇵🇸"], ["PT", "🇵🇹"], ["PW", "🇵🇼"], ["PY", "🇵🇾"], ["QA", "🇶🇦"], ["RE", "🇷🇪"], ["RO", "🇷🇴"], ["RS", "🇷🇸"], ["RU", "🇷🇺"], ["RW", "🇷🇼"], ["SA", "🇸🇦"], ["SB", "🇸🇧"], ["SC", "🇸🇨"], ["SD", "🇸🇩"], ["SE", "🇸🇪"], ["SG", "🇸🇬"], ["SI", "🇸🇮"], ["SK", "🇸🇰"], ["SL", "🇸🇱"], ["SM", "🇸🇲"], ["SN", "🇸🇳"], ["SR", "🇸🇷"], ["ST", "🇸🇹"], ["SV", "🇸🇻"], ["SY", "🇸🇾"], ["SZ", "🇸🇿"], ["TC", "🇹🇨"], ["TD", "🇹🇩"], ["TG", "🇹🇬"], ["TH", "🇹🇭"], ["TJ", "🇹🇯"], ["TL", "🇹🇱"], ["TM", "🇹🇲"], ["TN", "🇹🇳"], ["TO", "🇹🇴"], ["TR", "🇹🇷"], ["TT", "🇹🇹"], ["TV", "🇹🇻"], ["TW", "🇨🇳"], ["TZ", "🇹🇿"], ["UA", "🇺🇦"], ["UG", "🇺🇬"], ["UK", "🇬🇧"], ["UM", "🇺🇲"], ["US", "🇺🇸"], ["UY", "🇺🇾"], ["UZ", "🇺🇿"], ["VA", "🇻🇦"], ["VC", "🇻🇨"], ["VE", "🇻🇪"], ["VG", "🇻🇬"], ["VI", "🇻🇮"], ["VN", "🇻🇳"], ["VU", "🇻🇺"], ["WS", "🇼🇸"], ["YE", "🇾🇪"], ["YT", "🇾🇹"], ["ZA", "🇿🇦"], ["ZM", "🇿🇲"], ["ZW", "🇿🇼"]]);
const city0 = "未知地区";
const isp0 = "未知服务商";

// 脚本开始
// 请求响应体解析
let body = $response.body;
let obj = JSON.parse(body);

// 用于将繁体中文转换为简体中文的函数
function traditionalToSimplified(para) {
  // 使用简单的替换规则，可以使用更复杂的转换库如 opencc.js
  const tradToSimpMap = {
'愛': '爱',
'學': '学',
'醫': '医',
'電': '电',
'腦': '脑',
'話': '话',
'車': '车',
'書': '书',
'飛': '飞',
'機': '机',
'場': '场',
'火': '火',
'圖': '图',
'飯': '饭',
'廳': '厅',
'園': '园',
'商': '商',
'店': '店',
'銀': '银',
'行': '行',
'郵': '邮',
'局': '局',
'超': '超',
'市': '市',
'生': '生',
'藥': '药',
'動': '动',
'物': '物',
'影': '影',
'音': '音',
'樂': '乐',
'遊': '游',
'敗': '败',
'寶': '宝',
'報': '报',
'貝': '贝',
'畢': '毕',
'邊': '边',
'變': '变',
'標': '标',
'表': '表',
'餅': '饼',
'撥': '拨',
'薄': '薄',
'布': '布',
'步': '步',
'財': '财',
'參': '参',
'殘': '残',
'慚': '惭',
'燦': '灿',
'倉': '仓',
'滄': '沧',
'艙': '舱',
'蒼': '苍',
'測': '测',
'層': '层',
'冊': '册',
'側': '侧',
'廁': '厕',
'插': '插',
'察': '察',
'產': '产',
'顫': '颤',
'場': '场',
'嘗': '尝',
'長': '长',
'場': '场',
'腸': '肠',
'償': '偿',
'暢': '畅',
'車': '车',
'徹': '彻',
'塵': '尘',
'趁': '趁',
'稱': '称',
'誠': '诚',
'騁': '骋',
'撐': '撑',
'橙': '橙',
'誠': '诚',
'徹': '彻',
'塵': '尘',
'稱': '称',
'沖': '冲',
'摻': '掺',
'檐': '檐',
'充': '充',
'衝': '冲',
'寵': '宠',
'貢': '贡',
'崇': '崇',
'範': '范',
'瘢': '瘢',
'篤': '笃',
'空': '空',
'總': '总',
'帶': '带',
'當': '当',
'黨': '党',
'島': '岛',
'倒': '倒',
'稻': '稻',
'盜': '盗',
'碘': '碘',
'點': '点',
'電': '电',
'釘': '钉',
'頂': '顶',
'訂': '订',
'鈿': '钿',
'丟': '丢',
'東': '东',
'凍': '冻',
'動': '动',
'鬥': '斗',
'獨': '独',
'賭': '赌',
'篤': '笃',
'渡': '渡',
'鍍': '镀',
'斷': '断',
'緞': '缎',
'鍛': '锻',
'壩': '坝',
'隊': '队',
'對': '对',
'噸': '吨',
'俄': '俄',
'惡': '恶',
'餓': '饿',
'發': '发',
'罰': '罚',
'閥': '阀',
'砝': '砝',
'飯': '饭',
'販': '贩',
'礬': '矾',
'釩': '钒',
'汎': '泛',
'範': '范',
'緋': '绯',
'非': '非',
'誹': '诽',
'廢': '废',
'費': '费',
'紡': '纺',
'訪': '访',
'龐': '庞',
'紛': '纷',
'墳': '坟',
'憤': '愤',
'奮': '奋',
'豐': '丰',
'瘋': '疯',
'風': '风',
好的，这里是更多的繁简字对照：

```
'鳳': '凤',
'膚': '肤',
'輔': '辅',
'負': '负',
'賦': '赋',
'複': '复',
'婦': '妇',
'縫': '缝',
'擴': '扩',
'喬': '乔',
'虧': '亏',
'擠': '挤',
'劃': '划',
'劍': '剑',
'劍': '剑',
'劉': '刘',
'匯': '汇',
'匯': '汇',
'厲': '厉',
'團': '团',
'圖鑒': '图鉴',
'園': '园',
'塊': '块',
'墻': '墙',
'墾': '垦',
'壁': '壁',
'廊': '廊',
'廢': '废',
'廣': '广',
'較': '较',
'勁': '劲',
'勳': '勋',
'動': '动',
'勸': '劝',
'務': '务',
'勞': '劳',
'務': '务',
'勢': '势',
'匯': '汇',
'區': '区',
'協': '协',
'紀': '纪',
'緊': '紧',
'繾': '缱',
'繞': '绕',
'縈': '萦',
'繼': '继',
'縱': '纵',
'繁': '繁',
'紅': '红',
'紋': '纹',
'緣': '缘',
'紛': '纷',
'經': '经',
'綠': '绿',
'縛': '缚',
'絲': '丝',
'纜': '缆',
'纖': '纤',
'綏': '绥',
'義': '义',
'詩': '诗',
'訂': '订',
'專': '专',
'會': '会',
'湯': '汤',
'斂': '敛',
'說': '说',
'谘': '谘',
'譽': '誉',
'証': '证',
'認': '认',
'譯': '译',
'誓': '誓',
'話': '话',
'語': '语',
'請': '请',
'誌': '志',
'試': '试',
'賓': '宾',
'萬': '万',
'儀': '仪',
'價': '价',
'優': '优',
'體': '体',
'俠': '侠',
'傢': '家',
'儉': '俭',
'億': '亿',
'儐': '傧',
'僥': '侥',
'儈': '侩',
'贊': '赞',
'輪': '轮',
'軟': '软',
'輸': '输',
'轂': '毂',
'鎮': '镇',
'鑲': '镶',
'鏈': '链',
'鏽': '锈',
'鑄': '铸',
'鐘': '钟',
'鑽': '钻',
'鉛': '铅',
'鎖': '锁',
'鋼': '钢',
'錘': '锤',
'銅': '铜',
'鑑': '鉴',
'鐘': '钟',
'鐵': '铁',
'鈴': '铃',
'鋸': '锯',
'鋒': '锋',
'鎂': '镁',
'鐺': '铛',
'鍛': '锻',
'鑰': '钥',
'鑒': '鉴',
'鋅': '锌',
'鈾': '铀',
'鋼': '钢',
'鎢': '钨',
'鉀': '钾',
'銳': '锐',
'鍋': '锅',
'關': '关',
'隱': '隐',
'隴': '陇',
'際': '际',
'隻': '只',
'隸': '隶',
'階': '阶',
'隻': '只',
'隠': '隐',
'險': '险',
'雙': '双',
'難': '难',
'門': '门',
'閑': '闲',
'閘': '闸',
'間': '间',
'關': '关',
'閱': '阅',
'戰': '战',
'歲': '岁',
'孫': '孙',
'學': '学',
'寶': '宝',
'寳': '宝',
'實': '实',
'寧': '宁',
'當': '当',
'審': '审',
'寫': '写',
'屬': '属',
'層': '层',
'屆': '届',
'屢': '屡',
'濾': '滤',
'簣': '篑',
'篤': '笃',
'範': '范',
'簽': '签',
'篋': '箧',
'簡': '简',
'籌': '筹',
'籬': '篱',
'篩': '筛',
'簞': '箪',
'簍': '篓',
'簡': '简',
'簫': '箫',
'類': '类',
'簪': '簪',
'簡': '简',
'稻': '稻',
'穎': '颖',
'穀': '谷',
'穌': '稣',
'穟': '颖',
'穀': '谷',
'積': '积',
'穎': '颖',
'積': '积',
'穀': '谷',
'穧': '稷',
'穹': '穹',
'秈': '籼',
'稱': '称',
'稱': '称',
'磯': '磯',
'礁': '礁',
'磴': '磴',
'礪': '砺',
'礎': '础',
'碼': '码',
'磁': '磁',
'礱': '砻',
'磧': '碛',
'磯': '磯',
'稭': '稭',
'窮': '穷',
'窚': '窗',
'窘': '窘',
'竈': '灶',
'築': '筑',
'範': '范',
'築': '筑',
'籠': '笼',
'簀': '簀',
'簡': '简',
'簡': '简',
'簡': '简',
'簡': '简',
'簞': '箪',
'籟': '籟',
'纓': '缨',
'筆': '笔',
'粱': '粱',
'糠': '糠',
'糞': '粪',
'糊': '糊',
'系': '系',
'系': '系',
'糲': '粝',
'織': '织',
'紀': '纪',
'纓': '缨',
'緒': '绪',
'網': '网',
'網': '网',
'緊': '紧',
'繁': '繁',
'纓': '缨',
'網': '网',
'線': '线',
'縵': '缦',
'綸': '纶',
'衛': '卫',
'鯨': '鲸',
'鮪': '鲔',
'鮮': '鲜',
'鮑': '鲍',
'鮪': '鲔',
'鮮': '鲜',
'鲴': '鲴',
'鰂': '鲗',
'鰨': '鲽',
'鱖': '鳜',
'鰃': '鳂',
'鰣': '鲥',
'鰌': '鰍',
'龜': '龟',
'鵲': '鹊',
'鷊': '鹝',
'鷗': '鸥',
'鷂': '鹞',
'鷙': '鹘',
'鷱': '鹱',
'鸛': '鹳',
'鳳': '凤',
'鷯': '鹩',
'鷽': '鸴',
'鹼': '碱',
'麉': '麉',
'黃': '黄',
'黚': '黚',
'黃': '黄',
'黑': '黑',
'黃': '黄',
'黃': '黄',
'龍': '龙',
'龜': '龟',
'鱆': '鱆',
'鯨': '鲸',
'鯉': '鲤',
'麗': '丽',
'鮪': '鲔',
'鲮': '鲮',
'鯉': '鲤',
'鮪': '鲔',
'龜': '龟',

```
    // 添加更多繁体到简体的映射
  };

  return para.replace(/[\u4e00-\u9fa5]/g, char => tradToSimpMap[char] || char);
}

const country = country_check(traditionalToSimplified(obj['country']));
const city = city_check(traditionalToSimplified(obj['city']));

// 展示在顶部开关左边（第1行） 格式：国旗 国家名 地区名 城市名
let title = flags.get(obj['countryCode']) + ' ' + append(country, traditionalToSimplified(obj['regionName'])) + ' ' + append('', city);
// 展示在顶部开关左边（第2行） 格式：IP IPS
let subtitle = obj['query'] + ' ' + isp_check(obj['as']);
// 不展示
let ip = obj['query'];
// 长按节点选择“查看节点信息”时的信息
let description = '国家：' + obj['countryCode'] + ' ' + country + '\n'
  + '地区：' + obj['region'] + ' ' + city_check(traditionalToSimplified(obj['regionName'])) + '\n'
  + '城市：' + city + '\n'
  + 'IP：' + obj['query'] + '\n'
  + '服务商：' + traditionalToSimplified(obj['isp']) + '\n'
  + '经纬度：' + obj['lat'] + ' / ' + obj['lon'] + '\n'
  + '时区：' + obj['timezone'];
$done({title, subtitle, ip, description});

function country_check(para) {
  return para || city0;
}

function city_check(para) {
  if (!para) return city0;
  // 去除所有空格
  const paraWithoutSpaces = para.replace(/\s/g, '');

  // 使用正则表达式检查是否全是英文字母
  if (/^[a-zA-Z]+$/.test(paraWithoutSpaces)) {
    return ''; // 如果全是英文字母则返回空
  } else {
    return para; // 否则返回 para
  }
}

function isp_check(para) {
  return para || isp0;
}

function append(region, city) {
  return region + (city ? ' ' + city : '');
}